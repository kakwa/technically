<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Reversing WoWs Resource Format - Part 2: Getting The Metadata | Technically some technical stuff, or not.</title>
<meta property='og:title' content='Reversing WoWs Resource Format - Part 2: Getting The Metadata - Technically some technical stuff, or not.'><meta property='og:description' content='Parts Part 1 — Searching The Data → /posts/wows_depack_part1/ Part 2 — Getting The Metadata → /posts/wows_depack_part2/ Part 3 — Reading The Database → /posts/wows_depack_part3/ Part 4 — Tidying-Up The Project → /posts/wows_depack_part4/ Searching & Reading The Metadata In Part 1, we discovered:
Data lives in res_packages/ as custom .pkg archives. Each .pkg is a sequence of DEFLATE-compressed blobs separated by 64-bit IDs with zero padding. No file names inside .'><meta property='og:url' content='https://technically.kakwalab.ovh/posts/wows_depack_part2/'><meta property='og:site_name' content='Technically some technical stuff, or not.'><meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/bf9868bd766533e965b2eb1ed2d4ef76?s=256'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2025-08-27T00:02:00+02:00'><meta property='article:modified_time' content='2025-08-27T00:02:00+02:00'><meta name=twitter:card content='summary'><meta name=twitter:site content='@'><meta name=twitter:creator content='@'><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://technically.kakwalab.ovh/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://technically.kakwalab.ovh/posts/wows_depack_part2/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://technically.kakwalab.ovh/><h1 id=nav-heading class="title is-4">Technically some technical stuff, or not.</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/kakwa target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</i></span></a><a class=level-item aria-label=mastodon href=https://mastodon.instance/@kakwa target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M11.966876.80329086C9.1123466.82665791 6.3664935 1.1367094 4.7662978 1.8737549c0 0-3.1736685 1.4237835-3.1736685 6.2815982.0 1.1123884-.021554 2.4424309.013571 3.8529439.1152443 4.750677.8683725 9.432704 5.2479219 10.595273 2.0193066.53604 3.7531218.648348 5.1494078.571373 2.532141-.140797 3.953603-.906282 3.953603-.906282l-.08353-1.842608s-1.809527.572181-3.841713.50245c-2.013417-.06922-4.138986-.217713-4.4646269-2.696937-.030082-.217772-.045075-.450712-.045075-.695267.0.0 1.9765387.484554 4.4813709.599656 1.531629.07049 2.9679-.08996 4.426746-.264563 2.797636-.335045 5.233581-2.063856 5.539741-3.643517.482392-2.488386.442651-6.0725219.442651-6.0725219.0-4.8578147-3.173492-6.2815982-3.173492-6.2815982C17.639136 1.1367094 14.891579.82669685 12.03704.80329086z"/><path d="M6.4286668 14.016701V9.1034254c0-1.0041614.2549569-1.8022059.7670342-2.3925638.5280486-.590366 1.2196579-.8929946 2.0781049-.8929946.9931961.0 1.7452181.3828583 2.2425191 1.1486808L11.999859 7.7793695 12 11.451148 11.999859 7.7793695l.483533-.8128217c.497204-.7658225 1.249226-1.1486808 2.242528-1.1486808.858341.0 1.549951.3026286 2.078097.8929946.511971.5903579.766887 1.3884024.766887 2.3925638v4.9132756"/></svg>
</i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/pfcarpentier target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"></div><h2 class="subtitle is-6">August 27, 2025</h2><h1 class=title>Reversing WoWs Resource Format - Part 2: Getting The Metadata</h1><div class=content><h1 id=parts>Parts</h1><ul><li>Part 1 — Searching The Data → <a href=/posts/wows_depack_part1/>/posts/wows_depack_part1/</a></li><li>Part 2 — Getting The Metadata → <a href=/posts/wows_depack_part2/>/posts/wows_depack_part2/</a></li><li>Part 3 — Reading The Database → <a href=/posts/wows_depack_part3/>/posts/wows_depack_part3/</a></li><li>Part 4 — Tidying-Up The Project → <a href=/posts/wows_depack_part4/>/posts/wows_depack_part4/</a></li></ul><h1 id=searching--reading-the-metadata>Searching & Reading The Metadata</h1><p>In Part 1, we discovered:</p><ul><li>Data lives in <code>res_packages/</code> as custom <code>.pkg</code> archives.</li><li>Each <code>.pkg</code> is a sequence of DEFLATE-compressed blobs separated by 64-bit IDs with zero padding.</li><li>No file names inside <code>.pkg</code>; names/paths must exist elsewhere (in indexes).</li></ul><p>Now we need to find where and how the file and directory structure is stored.</p><h2 id=back-to-file-exploration>Back To File Exploration</h2><p>The metadata hopefully isn&rsquo;t embedded in executables. Let&rsquo;s search:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># List all files</span>
</span></span><span style=display:flex><span><span style=color:#75715e># then remove uninteresting bits like replays, crashes, DLLs, logs, .pkg or CEF stuff (embedded Chrome used for the armory, inventory, dockyard and clan base))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kakwa@linux Games/World of Warships » find ./ -type f | grep -v cef | grep -v replays | grep -v crashes | grep -v <span style=color:#e6db74>&#39;.pkg&#39;</span> | grep -v <span style=color:#e6db74>&#39;.dll&#39;</span> | grep -v <span style=color:#e6db74>&#39;.log&#39;</span>  | grep -v <span style=color:#e6db74>&#39;\.exe&#39;</span> | less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>./bin/6775398/res/texts/pl/LC_MESSAGES/global.mo
</span></span><span style=display:flex><span>./bin/6775398/res/texts/zh_tw/LC_MESSAGES/global.mo
</span></span><span style=display:flex><span>./bin/6775398/res/texts/fr/LC_MESSAGES/global.mo
</span></span><span style=display:flex><span>./bin/6775398/res/texts/zh_sg/LC_MESSAGES/global.mo
</span></span><span style=display:flex><span>./bin/6775398/res/camerasConsumer.xml
</span></span><span style=display:flex><span>./bin/6775398/bin32/paths.xml
</span></span><span style=display:flex><span>./bin/6775398/bin32/Licenses.txt
</span></span><span style=display:flex><span>./bin/6775398/bin32/monitor_config.json
</span></span><span style=display:flex><span>./bin/6775398/bin64/paths.xml
</span></span><span style=display:flex><span>./bin/6775398/bin64/Licenses.txt
</span></span><span style=display:flex><span>./bin/6775398/bin64/monitor_config.json
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>./bin/6775398/idx/spaces_dock_dry.idx
</span></span><span style=display:flex><span>./bin/6775398/idx/spaces_dock_hsf.idx
</span></span><span style=display:flex><span>./bin/6775398/idx/spaces_sea_hope.idx
</span></span><span style=display:flex><span>./bin/6775398/idx/vehicles_pve.idx
</span></span><span style=display:flex><span>./bin/6775398/idx/vehicles_level8_fr.idx
</span></span><span style=display:flex><span>./bin/6775398/idx/vehicles_level5_panasia.idx
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>The <code>.idx</code> files look promising, especially their names match the <code>.pkg</code> files:</p><ul><li><code>spaces_dock_hsf.idx</code> → <code>spaces_dock_hsf_0001.pkg</code></li><li><code>vehicles_level9_ned.idx</code> → <code>vehicles_level9_ned_0001.pkg</code></li></ul><h2 id=checking-we-have-the-metadata>Checking We Have The Metadata</h2><p>Let&rsquo;s take a look:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux bin/6775398/idx » strings -n <span style=color:#ae81ff>5</span> system_data.idx
</span></span><span style=display:flex><span><span style=color:#75715e>#%B&#39;E</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#%B&#39;E</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#%B&#39;E</span>
</span></span><span style=display:flex><span>E<span style=color:#f92672>)</span>zj<span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>FM&#39;</span>lb
</span></span><span style=display:flex><span>%<span style=color:#f92672>}</span>n:b
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>	?A+
</span></span><span style=display:flex><span>c|<span style=color:#e6db74>&#39;lY
</span></span></span><span style=display:flex><span><span style=color:#e6db74>zc78&#39;</span>
</span></span><span style=display:flex><span>tKDStorage.bin
</span></span><span style=display:flex><span>waves_heights1.dds
</span></span><span style=display:flex><span>animatedMiscs.xml
</span></span><span style=display:flex><span>LowerDeck.dds
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>maps
</span></span><span style=display:flex><span>helpers
</span></span><span style=display:flex><span>FoamMapLowFreq.dds
</span></span><span style=display:flex><span>tritanopia.dds
</span></span><span style=display:flex><span>color_correct_default.dds
</span></span><span style=display:flex><span>Color.dds
</span></span><span style=display:flex><span>Shimmer.dds
</span></span><span style=display:flex><span>highlight_noise.dds
</span></span><span style=display:flex><span>space_variation_dummy.dds
</span></span><span style=display:flex><span>waves_heights0.dds
</span></span><span style=display:flex><span>4F$<span style=color:#f92672>)</span>p
</span></span><span style=display:flex><span>E<span style=color:#f92672>)</span>zjp
</span></span><span style=display:flex><span> |5*y
</span></span><span style=display:flex><span>FM<span style=color:#e6db74>&#39;lp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>k4|W8
</span></span></span><span style=display:flex><span><span style=color:#e6db74>%}n:p
</span></span></span><span style=display:flex><span><span style=color:#e6db74>(	?A+
</span></span></span><span style=display:flex><span><span style=color:#e6db74>c|&#39;</span>lp
</span></span><span style=display:flex><span>LrL<span style=color:#f92672>)</span>t
</span></span><span style=display:flex><span>atw|$
</span></span><span style=display:flex><span>:M+Xp
</span></span><span style=display:flex><span>F?mep
</span></span><span style=display:flex><span>wsystem_data_0001.pkg
</span></span></code></pre></div><p>Bingo, we have all the file names, and at the end, the name of the corresponding <code>.pkg</code> file.</p><p>These <code>.idx</code> files, as the extension indicates, are our indexes containing all the file names and metadata.</p><p>Also, note that we have a few names (like <code>maps</code> or <code>helpers</code>) without extensions, these are probably directory names.</p><p><strong>Note</strong>: <code>bin/</code> directory and game versions</p><p>The <code>./bin</code> directory contains build-numbered subdirectories (5241351, 6081105, etc.), with WoWs keeping the current and previous builds. We&rsquo;ll use the highest number for the latest indexes.</p><h1 id=idx-file-structure>IDX File Structure</h1><h2 id=general-layout>General Layout</h2><p>Let&rsquo;s examine an index file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx | less
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  <span style=color:#ae81ff>91</span> 9d <span style=color:#ae81ff>39</span> b4 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP......9.@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 1c <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |7...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  f6 3b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>........;......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>71</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  0e <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |6q..............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000040</span>  e0 <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  8f 0c 9a ba 4f <span style=color:#ae81ff>40</span> b6 <span style=color:#ae81ff>93</span>  |.&amp;..........O@..|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000050</span>  <span style=color:#ae81ff>27</span> b9 <span style=color:#ae81ff>08</span> b1 d1 a1 b1 db  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#e6db74>&#39;...............|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000060  ce 26 00 00 00 00 00 00  8f ec 87 4a 28 d0 f7 c7  |.&amp;.........J(...|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000070  a4 eb 1b 3e 50 21 d8 74  12 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000080  c1 26 00 00 00 00 00 00  ad 70 a2 e7 ac 2c 4f 6b  |.&amp;.......p...,Ok|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000090  27 b9 08 b1 d1 a1 b1 db  0e 00 00 00 00 00 00 00  |&#39;</span>...............|
</span></span><span style=display:flex><span>000000a0  b3 <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  4e <span style=color:#ae81ff>84</span> a5 6a <span style=color:#ae81ff>94</span> dc 1f 7f  |.&amp;......N..j....|
</span></span><span style=display:flex><span>000000b0  <span style=color:#ae81ff>62</span> f5 aa 4b 5e <span style=color:#ae81ff>15</span> 7f <span style=color:#ae81ff>93</span>  <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |b..K^...........|
</span></span><span style=display:flex><span>000000c0  a1 <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  4e b0 fe <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>40</span> a5 <span style=color:#ae81ff>65</span>  |.&amp;......N..#b@.e|
</span></span><span style=display:flex><span>000000d0  <span style=color:#ae81ff>27</span> b9 <span style=color:#ae81ff>08</span> b1 d1 a1 b1 db  <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#e6db74>&#39;....... .......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000000e0  91 26 00 00 00 00 00 00  8e c7 6a 58 7c 86 62 33  |.&amp;........jX|.b3|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000000f0  27 b9 08 b1 d1 a1 b1 db  0f 00 00 00 00 00 00 00  |&#39;</span>...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000100</span>  <span style=color:#ae81ff>91</span> <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  8e <span style=color:#ae81ff>43</span> 3d e9 cf <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>52</span> a4  |.&amp;.......C<span style=color:#f92672>=</span>..IR.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000110</span>  <span style=color:#ae81ff>62</span> f5 aa 4b 5e <span style=color:#ae81ff>15</span> 7f <span style=color:#ae81ff>93</span>  <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |b..K^...........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000120</span>  <span style=color:#ae81ff>80</span> <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  0e 3c 9a 6d <span style=color:#ae81ff>22</span> de 7b da  |.&amp;.......&lt;.m<span style=color:#e6db74>&#34;.{.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000130  4e b0 fe 23 62 40 a5 65  0b 00 00 00 00 00 00 00  |N..#b@.e........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000140  76 26 00 00 00 00 00 00  0e 48 58 ea 50 44 1a 47  |v&amp;.......HX.PD.G|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000150  df 61 50 67 c7 3a dd 7a  13 00 00 00 00 00 00 00  |.aPg.:.z........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000160  61 26 00 00 00 00 00 00  e0 9f c3 bd d2 12 20 04  |a&amp;............ .|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000170  09 28 f1 df 2d 04 93 de  0b 00 00 00 00 00 00 00  |.(..-...........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000180  54 26 00 00 00 00 00 00  e0 95 53 f6 cc 08 c0 46  |T&amp;........S....F|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000190  06 cf 85 bd 69 99 e2 46  0d 00 00 00 00 00 00 00  |....i..F........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000001a0  3f 26 00 00 00 00 00 00  e0 99 68 5e 2d 70 13 72  |?&amp;........h^-p.r|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000001b0  4c d1 2e 30 73 38 d9 13  10 00 00 00 00 00 00 00  |L..0s8..........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[...]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002660  53 15 00 00 00 00 00 00  a4 eb 1b 3e 50 21 d8 74  |S..........&gt;P!.t|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002670  38 e6 83 3c 74 a7 20 b2  0a 00 00 00 00 00 00 00  |8..&lt;t. .........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002680  37 15 00 00 00 00 00 00  e7 c6 0b ae d5 31 51 55  |7............1QU|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002690  a4 eb 1b 3e 50 21 d8 74  0c 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026a0  21 15 00 00 00 00 00 00  00 40 cc c7 49 c4 54 09  |!........@..I.T.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026b0  a4 eb 1b 3e 50 21 d8 74  14 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026c0  0d 15 00 00 00 00 00 00  ce 6a 28 bc cf e7 79 c8  |.........j(...y.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026d0  a4 eb 1b 3e 50 21 d8 74  1a 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026e0  01 15 00 00 00 00 00 00  6c c0 c9 f7 7e 00 03 05  |........l...~...|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026f0  a4 eb 1b 3e 50 21 d8 74  13 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002700  fb 14 00 00 00 00 00 00  74 d1 1b 8d f4 ff 7a ce  |........t.....z.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002710  a4 eb 1b 3e 50 21 d8 74  4b 44 53 74 6f 72 61 67  |...&gt;P!.tKDStorag|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002720  65 2e 62 69 6e 00 77 61  76 65 73 5f 68 65 69 67  |e.bin.waves_heig|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002730  68 74 73 31 2e 64 64 73  00 61 6e 69 6d 61 74 65  |hts1.dds.animate|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002740  64 4d 69 73 63 73 2e 78  6d 6c 00 4c 6f 77 65 72  |dMiscs.xml.Lower|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002750  44 65 63 6b 2e 64 64 73  00 63 6f 6d 6d 61 6e 64  |Deck.dds.command|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002760  5f 6d 61 70 70 69 6e 67  00 61 75 74 6f 74 65 73  |_mapping.autotes|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002770  74 73 5f 64 72 61 77 5f  67 75 69 5f 73 65 74 74  |ts_draw_gui_sett|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002780  69 6e 67 73 2e 78 6d 6c  00 48 6f 75 73 65 46 72  |ings.xml.HouseFr|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002790  6f 6e 74 2e 64 64 73 00  70 72 65 73 65 74 5f 6b  |ont.dds.preset_k|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000027a0  65 79 62 6f 61 72 64 5f  31 2e 78 6d 6c 00 69 6e  |eyboard_1.xml.in|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000027b0  74 65 72 66 61 63 65 73  00 76 65 72 64 61 6e 61  |terfaces.verdana|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000027c0  5f 73 6d 61 6c 6c 2e 66  6f 6e 74 00 73 70 61 63  |_small.font.spac|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000027d0  65 5f 64 65 66 73 00 61  69 64 5f 6e 75 6c 6c 2e  |e_defs.aid_null.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000027e0  64 64 73 00 63 61 6d 6f  75 66 6c 61 67 65 73 2e  |dds.camouflages.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000027f0  78 6d 6c 00 63 68 75 6e  6b 2e 64 64 73 00 66 6f  |xml.chunk.dds.fo|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002800  6e 74 63 6f 6e 66 69 67  2e 78 6d 6c 00 46 6f 61  |ntconfig.xml.Foa|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002810  6d 4d 61 70 2e 64 64 73  00 42 75 69 6c 64 69 6e  |mMap.dds.Buildin|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002820  67 2e 64 65 66 00 63 6f  6e 66 69 67 2e 78 6d 6c  |g.def.config.xml|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002830  00 67 61 6d 65 5f 77 69  6e 64 5f 6e 6f 69 73 65  |.game_wind_noise|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002840  2e 64 64 73 00 47 61 6d  65 50 61 72 61 6d 73 2e  |.dds.GameParams.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002850  64 61 74 61 00 44 65 62  75 67 44 72 61 77 45 6e  |data.DebugDrawEn|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002860  74 69 74 79 2e 64 65 66  00 63 6f 6e 74 65 6e 74  |tity.def.content|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002870  00 4c 6f 77 65 72 46 6f  72 77 61 72 64 54 72 61  |.LowerForwardTra|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002880  6e 73 2e 64 64 73 00 55  49 50 61 72 61 6d 73 2e  |ns.dds.UIParams.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[...]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003bc0  2e 64 64 73 00 68 69 67  68 6c 69 67 68 74 5f 6e  |.dds.highlight_n|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003bd0  6f 69 73 65 2e 64 64 73  00 73 70 61 63 65 5f 76  |oise.dds.space_v|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003be0  61 72 69 61 74 69 6f 6e  5f 64 75 6d 6d 79 2e 64  |ariation_dummy.d|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003bf0  64 73 00 77 61 76 65 73  5f 68 65 69 67 68 74 73  |ds.waves_heights|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c00  30 2e 64 64 73 00 8f 0c  9a ba 4f 40 b6 93 70 11  |0.dds.....O@..p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c10  03 07 0d 33 ed 77 00 00  00 00 00 00 00 00 05 00  |...3.w..........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c20  00 00 01 00 00 00 f5 21  00 00 bf 00 45 5c 6c 36  |.......!....E\l6|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c30  00 00 00 00 00 00 8f ec  87 4a 28 d0 f7 c7 70 11  |.........J(...p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c40  03 07 0d 33 ed 77 1e 9b  ef 05 00 00 00 00 05 00  |...3.w..........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c50  00 00 01 00 00 00 15 15  01 00 03 77 63 97 3e ab  |...........wc.&gt;.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c60  02 00 00 00 00 00 ad 70  a2 e7 ac 2c 4f 6b 70 11  |.......p...,Okp.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c70  03 07 0d 33 ed 77 05 22  00 00 00 00 00 00 05 00  |...3.w.&#34;</span>........|
</span></span><span style=display:flex><span>00003c80  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> cb <span style=color:#ae81ff>01</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 6d b9 de c1 ad 0c  |..........m.....|
</span></span><span style=display:flex><span>00003c90  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 8e c7  6a <span style=color:#ae81ff>58</span> 7c <span style=color:#ae81ff>86</span> <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>33</span> <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |........jX|.b3p.|
</span></span><span style=display:flex><span>00003ca0  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> e0 <span style=color:#ae81ff>23</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w.#........|
</span></span><span style=display:flex><span>00003cb0  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> f1 d2 <span style=color:#ae81ff>87</span> 5a d2 <span style=color:#ae81ff>00</span>  |......e......Z..|
</span></span><span style=display:flex><span>00003cc0  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 8e <span style=color:#ae81ff>43</span>  3d e9 cf <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>52</span> a4 <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |.......C<span style=color:#f92672>=</span>..IR.p.|
</span></span><span style=display:flex><span>00003cd0  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> 4d 1f  6a <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.wM.j.......|
</span></span><span style=display:flex><span>00003ce0  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> bb <span style=color:#ae81ff>19</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> f7 <span style=color:#ae81ff>53</span> 4a b1 <span style=color:#ae81ff>38</span> ab  |...........SJ.8.|
</span></span><span style=display:flex><span>00003cf0  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 0e 3c  9a 6d <span style=color:#ae81ff>22</span> de 7b da <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |.......&lt;.m<span style=color:#e6db74>&#34;.{.p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003d00  03 07 0d 33 ed 77 55 24  00 00 00 00 00 00 05 00  |...3.wU</span>$<span style=color:#e6db74>........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[...]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000070a0  00 00 01 00 00 00 90 24  00 00 62 c1 d9 06 f8 d8  |.......</span>$<span style=color:#e6db74>..b.....|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000070b0  00 00 00 00 00 00 57 b3  82 06 56 f0 2a e6 70 11  |......W...V.*.p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000070c0  03 07 0d 33 ed 77 ea cc  15 0a 00 00 00 00 05 00  |...3.w..........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000070d0  00 00 01 00 00 00 7c 01  00 00 84 a8 12 1d 61 04  |......|.......a.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000070e0  00 00 00 00 00 00 57 64  91 29 c9 3c f0 96 70 11  |......Wd.).&lt;..p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000070f0  03 07 0d 33 ed 77 a9 ef  15 0a 00 00 00 00 05 00  |...3.w..........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007100  00 00 01 00 00 00 6f 09  00 00 fc 56 94 f8 9a 37  |......o....V...7|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007110  00 00 00 00 00 00 21 67  ac 70 22 ec ca b8 70 11  |......!g.p&#34;</span>...p.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007120</span>  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>28</span> f9  <span style=color:#ae81ff>15</span> 0a <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w<span style=color:#f92672>(</span>.........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007130</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 0b 2d  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>03</span> bd b0 <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>67</span> e9  |.......-.....Pg.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007140</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007150</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>79</span>  |......p....3.wsy|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007160</span>  <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>65</span> 6d 5f <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>74</span>  <span style=color:#ae81ff>61</span> 5f <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>31</span> 2e <span style=color:#ae81ff>70</span>  |stem_data_0001.p|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007170</span>  6b <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>00</span>                                          |kg.|
</span></span></code></pre></div><p>The general layout of the file appears to be at least in 3 chunks:</p><ul><li>A first chunk of metadata</li><li>All the file name strings <code>\0</code>-separated, but also a few strings without extensions, probably directory names</li><li>A second chunk of metadata</li></ul><p>Let&rsquo;s look for the IDs we found in the corresponding <code>.pkg</code> (here <code>system_data_0001.pkg</code>), for example <code>00 00 00 00 | bf 00 45 5c | 6c 36 00 00 | 00 00 00 00</code>.</p><pre tabindex=0><code>[......................] 00 8f 0c  9a ba 4f 40 b6 93 70 11  |0.dds.....O@..p.|
00003c10  03 07 0d 33 ed 77 00 00  00 00 00 00 00 00 05 00  |...3.w..........|
00003c20  00 00 01 00 00 00 f5 21  00 00 bf 00 45 5c 6c 36  |.......!....E\l6|
00003c30  00 00 00 00 00 00 8f ec [...]
</code></pre><p>Ok, it&rsquo;s there, in the second chunk. And it also works if we test for other IDs. We have at least a link by ID between the <code>.idx</code> and the <code>.pkg</code> file.</p><p>We will come back later to the second chunk, remembering that, but let&rsquo;s focus on the first chunk for now.</p><h2 id=metadata-chunk-format>Metadata Chunk Format</h2><p>The first section contains file metadata entries:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx | less
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  <span style=color:#ae81ff>91</span> 9d <span style=color:#ae81ff>39</span> b4 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP......9.@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 1c <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |7...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  f6 3b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>........;......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>71</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  0e <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |6q..............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000040</span>  e0 <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  8f 0c 9a ba 4f <span style=color:#ae81ff>40</span> b6 <span style=color:#ae81ff>93</span>  |.&amp;..........O@..|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000050</span>  <span style=color:#ae81ff>27</span> b9 <span style=color:#ae81ff>08</span> b1 d1 a1 b1 db  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#e6db74>&#39;...............|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000060  ce 26 00 00 00 00 00 00  8f ec 87 4a 28 d0 f7 c7  |.&amp;.........J(...|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000070  a4 eb 1b 3e 50 21 d8 74  12 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000080  c1 26 00 00 00 00 00 00  ad 70 a2 e7 ac 2c 4f 6b  |.&amp;.......p...,Ok|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000090  27 b9 08 b1 d1 a1 b1 db  0e 00 00 00 00 00 00 00  |&#39;</span>...............|
</span></span><span style=display:flex><span>000000a0  b3 <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  4e <span style=color:#ae81ff>84</span> a5 6a <span style=color:#ae81ff>94</span> dc 1f 7f  |.&amp;......N..j....|
</span></span><span style=display:flex><span>000000b0  <span style=color:#ae81ff>62</span> f5 aa 4b 5e <span style=color:#ae81ff>15</span> 7f <span style=color:#ae81ff>93</span>  <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |b..K^...........|
</span></span><span style=display:flex><span>000000c0  a1 <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  4e b0 fe <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>40</span> a5 <span style=color:#ae81ff>65</span>  |.&amp;......N..#b@.e|
</span></span><span style=display:flex><span>000000d0  <span style=color:#ae81ff>27</span> b9 <span style=color:#ae81ff>08</span> b1 d1 a1 b1 db  <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#e6db74>&#39;....... .......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000000e0  91 26 00 00 00 00 00 00  8e c7 6a 58 7c 86 62 33  |.&amp;........jX|.b3|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000000f0  27 b9 08 b1 d1 a1 b1 db  0f 00 00 00 00 00 00 00  |&#39;</span>...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000100</span>  <span style=color:#ae81ff>91</span> <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  8e <span style=color:#ae81ff>43</span> 3d e9 cf <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>52</span> a4  |.&amp;.......C<span style=color:#f92672>=</span>..IR.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000110</span>  <span style=color:#ae81ff>62</span> f5 aa 4b 5e <span style=color:#ae81ff>15</span> 7f <span style=color:#ae81ff>93</span>  <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |b..K^...........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000120</span>  <span style=color:#ae81ff>80</span> <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  0e 3c 9a 6d <span style=color:#ae81ff>22</span> de 7b da  |.&amp;.......&lt;.m<span style=color:#e6db74>&#34;.{.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000130  4e b0 fe 23 62 40 a5 65  0b 00 00 00 00 00 00 00  |N..#b@.e........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000140  76 26 00 00 00 00 00 00  0e 48 58 ea 50 44 1a 47  |v&amp;.......HX.PD.G|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000150  df 61 50 67 c7 3a dd 7a  13 00 00 00 00 00 00 00  |.aPg.:.z........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000160  61 26 00 00 00 00 00 00  e0 9f c3 bd d2 12 20 04  |a&amp;............ .|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000170  09 28 f1 df 2d 04 93 de  0b 00 00 00 00 00 00 00  |.(..-...........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002690  a4 eb 1b 3e 50 21 d8 74  0c 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026a0  21 15 00 00 00 00 00 00  00 40 cc c7 49 c4 54 09  |!........@..I.T.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026b0  a4 eb 1b 3e 50 21 d8 74  14 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026c0  0d 15 00 00 00 00 00 00  ce 6a 28 bc cf e7 79 c8  |.........j(...y.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026d0  a4 eb 1b 3e 50 21 d8 74  1a 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026e0  01 15 00 00 00 00 00 00  6c c0 c9 f7 7e 00 03 05  |........l...~...|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>000026f0  a4 eb 1b 3e 50 21 d8 74  13 00 00 00 00 00 00 00  |...&gt;P!.t........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002700  fb 14 00 00 00 00 00 00  74 d1 1b 8d f4 ff 7a ce  |........t.....z.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002710  a4 eb 1b 3e 50 21 d8 74  4b 44 53 74 6f 72 61 67  |...&gt;P!.tKDStorag|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002720  65 2e 62 69 6e 00 77 61  76 65 73 5f 68 65 69 67  |e.bin.waves_heig|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002730  68 74 73 31 2e 64 64 73  00 61 6e 69 6d 61 74 65  |hts1.dds.animate|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002740  64 4d 69 73 63 73 2e 78  6d 6c 00 4c 6f 77 65 72  |dMiscs.xml.Lower|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002750  44 65 63 6b 2e 64 64 73  00 63 6f 6d 6d 61 6e 64  |Deck.dds.command|
</span></span></span></code></pre></div><p>Staring at the hexdump long enough and we can start to see some patterns.</p><p>At regular intervals, every 256 bits, we get a 64-bit integer with a relatively low value, hinting at individual metadata sets of 256 bits.</p><p>This looks suspiciously like some kind of constant enum coded into a 64-bit integer.
My best guess right now would be some kind of file type code, itself defined as a constant in the game engine like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#75715e>#define FILE_TYPE_1 0x01
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define FILE_TYPE_2 0x02
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>// [...]
</span></span></span></code></pre></div><p>Let&rsquo;s call it <code>file_type</code> for now.</p><p>Looking at the end of the first chunk (right before we get <code>KDStorage.bin</code>), we have to go back 4 x 64 bits to get something that looks like a <code>file_type</code>.</p><p>This means <code>file_type</code> is the first field in the 256-bit structure.</p><p>Let&rsquo;s look at the next 64 bits: <code>ce 26 00 00 00 00 00 00</code>, <code>c1 26 00 00 00 00 00 00</code>, <code>80 26 00 00 00 00 00 00</code>, etc. These values are again rather small.</p><p>Also these values, at least for the first ones, are suspiciously close to <code>00002718</code>, i.e. right where the section containing the file names starts.</p><p>The last ones, <code>01 15 00 00 00 00 00 00</code>, <code>fb 14 00 00 00 00 00 00</code>, etc., are smaller, and suspiciously, they have similar values to the length of the file name section (approximately <code>0x00003c00 - 0x00002710 = 0x0000014f0</code>).</p><p>The second field is then probably some kind of offset. Most likely from the start of one 256-bit chunk to the start of one of the file names.</p><p>Looking at other <code>.idx</code> files seems to confirm that.</p><p>Let&rsquo;s call it <code>offset</code> for now.</p><p>Next, let&rsquo;s look at the remaining 128 bits.</p><pre tabindex=0><code>8f 0c 9a ba 4f 40 b6 93 | 27 b9 08 b1 d1 a1 b1 db
8f ec 87 4a 28 d0 f7 c7 | a4 eb 1b 3e 50 21 d8 74
ad 70 a2 e7 ac 2c 4f 6b | 27 b9 08 b1 d1 a1 b1 db
4e 84 a5 6a 94 dc 1f 7f | 62 f5 aa 4b 5e 15 7f 93
4e b0 fe 23 62 40 a5 65 | 27 b9 08 b1 d1 a1 b1 db
8e c7 6a 58 7c 86 62 33 | 27 b9 08 b1 d1 a1 b1 db
</code></pre><p>First thing to note: all the bits are used, which disqualifies offsets or simple enum IDs like before.</p><p>Right now, we are not even sure these 128 bits are part of one 128-bit field (for example a hash), two 64-bit integers, four 32-bit integers, or any combination of 16, 32 or 64 bits that ends up making a 128-bit chunk.</p><p>Looking at it more closely, the first 64 bits looks rather random, the last 64 bits however? we see quite a few values repeating themselves (ex: <code>27 b9 08 b1 d1 a1 b1 db</code>).</p><p>Let&rsquo;s check the whole file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx| grep <span style=color:#e6db74>&#39;00 00 00 00 00 00 00&#39;</span> | sed <span style=color:#e6db74>&#39;s/^..........//&#39;</span> | sed <span style=color:#e6db74>&#39;s/  .*//&#39;</span> | sort  | uniq -c | sort -n
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># note: first number is the number of occurrences</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> af
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> 1c 6a 8d 7f df 8e b3 <span style=color:#ae81ff>35</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>71</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 1c <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> 7d e3 1c a4 <span style=color:#ae81ff>35</span> 3e <span style=color:#ae81ff>98</span> 8b
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> e0 <span style=color:#ae81ff>95</span> <span style=color:#ae81ff>53</span> f6 cc <span style=color:#ae81ff>08</span> c0 <span style=color:#ae81ff>46</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>58</span> <span style=color:#ae81ff>36</span> c8 ec <span style=color:#ae81ff>47</span> 8b
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> 4e b0 fe <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>40</span> a5 <span style=color:#ae81ff>65</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> d0 d7 a5 ce a8 <span style=color:#ae81ff>86</span> 0e ae
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> 1a aa c7 3c 4e <span style=color:#ae81ff>76</span> ad <span style=color:#ae81ff>94</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> 4c d1 2e <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>38</span> d9 <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> 4c f0 ea c1 d5 5a 8d <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>88</span> <span style=color:#ae81ff>57</span> fc 1c <span style=color:#ae81ff>72</span> f3 <span style=color:#ae81ff>84</span> fa
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> ac <span style=color:#ae81ff>82</span> d5 f6 9e db <span style=color:#ae81ff>47</span> f9
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> b1 <span style=color:#ae81ff>86</span> <span style=color:#ae81ff>45</span> dc 7a <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>38</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>3</span> fc <span style=color:#ae81ff>27</span> <span style=color:#ae81ff>83</span> 2d <span style=color:#ae81ff>44</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>30</span> a3
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>76</span> <span style=color:#ae81ff>83</span> <span style=color:#ae81ff>17</span> b5 cf dd b7 0e
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>06</span> cf <span style=color:#ae81ff>85</span> bd <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>99</span> e2 <span style=color:#ae81ff>46</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>09</span> <span style=color:#ae81ff>28</span> f1 df 2d <span style=color:#ae81ff>04</span> <span style=color:#ae81ff>93</span> de
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>10</span> a4 eb 1b 3e <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>21</span> d8 <span style=color:#ae81ff>74</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>10</span> d7 <span style=color:#ae81ff>22</span> 2f fc 0a <span style=color:#ae81ff>67</span> 7a 0d
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>14</span> aa db f0 <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>89</span> b6 d8
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>15</span> df <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>67</span> c7 3a dd 7a
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>19</span> ac <span style=color:#ae81ff>65</span> 3f <span style=color:#ae81ff>91</span> <span style=color:#ae81ff>78</span> <span style=color:#ae81ff>97</span> dc
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>19</span> <span style=color:#ae81ff>38</span> e6 <span style=color:#ae81ff>83</span> 3c <span style=color:#ae81ff>74</span> a7 <span style=color:#ae81ff>20</span> b2
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>19</span> <span style=color:#ae81ff>59</span> dc e0 <span style=color:#ae81ff>43</span> fc <span style=color:#ae81ff>88</span> b7 7c
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>23</span> d3 9e <span style=color:#ae81ff>86</span> <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>25</span> <span style=color:#ae81ff>42</span> <span style=color:#ae81ff>27</span> <span style=color:#ae81ff>45</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>24</span> 0e <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>58</span> ea <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>44</span> 1a <span style=color:#ae81ff>47</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>33</span> d7 <span style=color:#ae81ff>19</span> f3 <span style=color:#ae81ff>03</span> 3e 6e <span style=color:#ae81ff>59</span> <span style=color:#ae81ff>03</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>34</span> <span style=color:#ae81ff>27</span> b9 <span style=color:#ae81ff>08</span> b1 d1 a1 b1 db
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>38</span> <span style=color:#ae81ff>62</span> f5 aa 4b 5e <span style=color:#ae81ff>15</span> 7f <span style=color:#ae81ff>93</span>
</span></span></code></pre></div><p>Indeed, the repetitions are quite frequent, and running the same command on other files yields roughly the same values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C particles.idx| grep <span style=color:#e6db74>&#39;00 00 00 00 00 00 00&#39;</span> | sed <span style=color:#e6db74>&#39;s/^..........//&#39;</span> | sed <span style=color:#e6db74>&#39;s/  .*//&#39;</span> | sort  | uniq -c | sort -n
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>27</span> b9 <span style=color:#ae81ff>08</span> b1 d1 a1 b1 db
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> 8e ae <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>1</span> bd <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> b7 <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>4</span> ca 2c b7 <span style=color:#ae81ff>97</span> <span style=color:#ae81ff>24</span> b8 1c <span style=color:#ae81ff>86</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>5</span> 1f <span style=color:#ae81ff>19</span> a6 0c a2 9b 7f b3
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>94</span> a1 <span style=color:#ae81ff>23</span> f4 c5 <span style=color:#ae81ff>41</span> b8 <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>91</span> cc <span style=color:#ae81ff>55</span> <span style=color:#ae81ff>52</span> <span style=color:#ae81ff>25</span> 2a <span style=color:#ae81ff>42</span> d4
</span></span><span style=display:flex><span>     <span style=color:#ae81ff>81</span> de 3e <span style=color:#ae81ff>45</span> 0e <span style=color:#ae81ff>99</span> dc <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>317</span> <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>52</span> <span style=color:#ae81ff>00</span> d6 <span style=color:#ae81ff>89</span> <span style=color:#ae81ff>64</span> 1d 2e
</span></span></code></pre></div><p>Moreover, <code>sound_music.idx</code>, which as the name implies probably only contains sound files, returns mostly one type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C sound_music.idx| grep <span style=color:#e6db74>&#39;00 00 00 00 00 00 00&#39;</span> | sed <span style=color:#e6db74>&#39;s/^..........//&#39;</span> | sed <span style=color:#e6db74>&#39;s/  .*//&#39;</span> | sort  | uniq -c | sort -n
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>513</span> <span style=color:#ae81ff>93</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>56</span> c2 <span style=color:#ae81ff>97</span> <span style=color:#ae81ff>75</span> <span style=color:#ae81ff>69</span>
</span></span></code></pre></div><p>Note: these commands are by no means accurate; they are likely to catch garbage and miscount. But these are quick and dirty ways to validate hypotheses.</p><p>So it seems we are dealing with another <code>file_type</code> field. Let&rsquo;s call it <code>file_type2</code>, and rename the first one <code>file_type1</code>.</p><p>So in the end, making a few assumptions for now, we have figured out the rough format of this section:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| T1 | T1 | T1 | T1 | T1 | T1 | T1 | T1 || OF | OF | OF | OF | OF | OF | OF | OF |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;---------- file type 1 --------------&gt;||&lt;------------ offset -----------------&gt;|
|               64 bits                 ||               64 bits                 |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| UN | UN | UN | UN | UN | UN | UN | UN || T2 | T2 | T2 | T2 | T2 | T2 | T2 | T2 |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;------------ unknown ----------------&gt;||&lt;---------- file type 2 --------------&gt;|
|               64 bits                 ||               64 bits                 |
</code></pre><h2 id=header-section-analysis>Header Section Analysis</h2><p>The <code>.idx</code> file header contains:</p><pre tabindex=0><code>00000000  49 53 46 50 00 00 00 02  91 9d 39 b4 40 00 00 00  |ISFP......9.@...|
00000010  37 01 00 00 1c 01 00 00  01 00 00 00 00 00 00 00  |7...............|
00000020  28 00 00 00 00 00 00 00  f6 3b 00 00 00 00 00 00  |(........;......|
00000030  36 71 00 00 00 00 00 00  0e 00 00 00 00 00 00 00  |6q..............|
00000040  e0 26 00 00 00 00 00 00  8f 0c 9a ba 4f 40 b6 93  |.&amp;..........O@..|
00000050  27 b9 08 b1 d1 a1 b1 db  13 00 00 00 00 00 00 00  |&#39;...............|
00000060  ce 26 00 00 00 00 00 00  8f ec 87 4a 28 d0 f7 c7  |.&amp;.........J(...|
00000070  a4 eb 1b 3e 50 21 d8 74  12 00 00 00 00 00 00 00  |...&gt;P!.t........|
00000080  c1 26 00 00 00 00 00 00  ad 70 a2 e7 ac 2c 4f 6b  |.&amp;.......p...,Ok|
00000090  27 b9 08 b1 d1 a1 b1 db  0e 00 00 00 00 00 00 00  |&#39;...............|
</code></pre><p>These first bytes don&rsquo;t look like the <code>section</code> previously mentioned; we have a magic number (<code>ISFP</code>), and then the content doesn&rsquo;t look like a <code>section</code> at first (too many low-value 32-bit integers).</p><p>This means we most likely have a header section containing things like:</p><ul><li>magic numbers</li><li>types</li><li>sizes</li><li>number of entries/files</li></ul><p>The first thing to determine is the size of the header. Looking at it, the first <code>section</code> starts at <code>0x38</code> (recognisable by the full 64-bit integers).</p><p>This means the header is 7 × 64 bits.</p><p>Let&rsquo;s analyze the content.</p><p>Looking at all the files, for the first 128 bits, we get:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n 1;<span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  1b <span style=color:#ae81ff>73</span> f9 d5 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP.....s..@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  <span style=color:#ae81ff>78</span> f0 2c <span style=color:#ae81ff>09</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP....x.,.@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  b8 fe ba b9 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP........@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  <span style=color:#ae81ff>06</span> <span style=color:#ae81ff>24</span> fa 2d <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP.....$.-@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  1e 7e f6 d9 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP.....~..@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  dd <span style=color:#ae81ff>21</span> <span style=color:#ae81ff>74</span> c2 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP.....!t.@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  <span style=color:#ae81ff>33</span> <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>63</span> bd <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP....3<span style=color:#f92672>(</span>c.@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  cb 5c e2 0d <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP.....<span style=color:#ae81ff>\.</span>.@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  cb e8 8a fd <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP........@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  6e <span style=color:#ae81ff>04</span> b1 <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP....n..b@...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span>  <span style=color:#ae81ff>15</span> 1c a2 f9 <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |ISFP........@...|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>As we can see, the 1st, 2nd, and 4th 32-bit chunks are always the same, and looking at the values, we have respectively:</p><ul><li>a magic number (<code>ISFP</code>),</li><li><code>00 00 00 02</code> which is rather weird (it could be some kind of ID if we were little-endian, but the format is big-endian). Maybe it is actually part of the magic number. As it doesn&rsquo;t vary, it&rsquo;s not too important for the task at hand here.</li><li><code>40 00 00 00</code> which, like <code>type 1</code>, looks like a low-value enum, and given its position in the index file, within the header, we are most likely dealing with an archive type. Again, as it doesn&rsquo;t vary, it&rsquo;s not really important.</li></ul><p>The 3rd 32-bit integer uses all the available bits, so it&rsquo;s unlikely a size. Maybe it&rsquo;s a CRC32 or a unique ID for the archives.</p><p>Edit: the <code>40 00 00 00</code> value upon closer inspection might not be an archive type; its value is 64 in decimal, which might be a header size, or simply storing the size of an integer.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| MA | MA | MA | MA || 00 | 00 | 00 | 02 || ID | ID | ID | ID || 40 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;----- magic -----&gt;||&lt;----- ???? ------&gt;||&lt;---- id/crc -----&gt;||&lt;----- ??????? ---&gt;|
</code></pre><p>Now, let&rsquo;s look at the next 128 bits (second line in the hexdump).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n <span style=color:#ae81ff>2</span> | tail -n 1;<span style=color:#66d9ef>done</span>                                                                                                                                                                                                                                    <span style=color:#ae81ff>130</span> ↵
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  bd <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> b7 <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>35</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 1d <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |5...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  5b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>[</span>...W...........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  5c <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>58</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#ae81ff>\.</span>..X...........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> ff <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>29</span> 3b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 0b 3b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>)</span>;...;..........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>04</span> <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  1e <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> c2 <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  a5 <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |....6...........|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>04</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> fb <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>79</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> a9 <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |y...............|
</span></span></code></pre></div><p>So here, we recognize two 32-bit integers due to the <code>00 00</code>, and then either a fixed 64-bit integer with always a <code>01 00 00 00 00 00 00 00</code> value, or something like two 32-bit integers with value <code>01 00 00 00</code> and <code>00 00 00 00</code> (as the value never varies, again, it&rsquo;s not that important).</p><p>Let&rsquo;s try to determine the two 32-bit values. Let&rsquo;s look at one of the files in particular:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx | less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 1c <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |7...............|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The first value is <span style=color:#e6db74>`</span><span style=color:#ae81ff>37</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> 00<span style=color:#e6db74>`</span>, i.e. converted to decimal, <span style=color:#e6db74>`</span>311<span style=color:#e6db74>`</span>. Doing a <span style=color:#e6db74>`</span>strings system_data.idx &gt; listing<span style=color:#e6db74>`</span> and removing the garbage <span style=color:#f92672>(</span>ex: <span style=color:#e6db74>`</span>w6~n<span style=color:#e6db74>`</span><span style=color:#f92672>)</span> as best as possible, plus the <span style=color:#e6db74>`</span>.pkg<span style=color:#e6db74>`</span> file name, only keeping files and directory names, we get <span style=color:#e6db74>`</span>310<span style=color:#e6db74>`</span> entries, a remarkably close value.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Looking at other files, story is similar, this field roughly matches the number of strings we get from <span style=color:#e6db74>`</span>strings<span style=color:#e6db74>`</span> <span style=color:#f92672>(</span>never perfectly however, but <span style=color:#66d9ef>if</span> the names are too short, <span style=color:#e6db74>`</span>strings<span style=color:#e6db74>`</span> will ignore them, most likely explaining the small delta we have each time<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Consequently we can deduce it<span style=color:#e6db74>&#39;s most likely the number of entries (files and directories) in the index file.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Next, we have `1c 01 00 00`, i.e. converted to decimal, `284`. This value is suspiciously close to the previous value. As we have both directories and file names, this number probably represents the number of items that are actual files.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Let&#39;</span>s validate that:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>```</span>shell
</span></span><span style=display:flex><span><span style=color:#75715e># Q&amp;D filtering out names without an extension (no &#39;.&#39;)</span>
</span></span><span style=display:flex><span>kakwa@linux 6775398/idx » cat listing | grep  <span style=color:#e6db74>&#39;\.&#39;</span> | wc -l
</span></span><span style=display:flex><span><span style=color:#ae81ff>284</span>
</span></span></code></pre></div><p>Bingo, we have the exact number we were looking for.</p><p>The last 64 bits could simply be ignored for now since they always have the same value.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| FD | FD | FD | FD || FI | FI | FI | FI || 01 | 00 | 00 | 00 || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;file + dir count &gt;||&lt;-- file count ---&gt;||&lt;-------------- ???? ------------------&gt;|
</code></pre><p>Next 128 bits:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n <span style=color:#ae81ff>3</span> | tail -n 1;<span style=color:#66d9ef>done</span> | less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>58</span> 8d <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>.......X.......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  7c 3f <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>.......|?......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>77</span> 2f <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>.......w/......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  bc e9 <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  c6 ea <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  a9 0f <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  c4 <span style=color:#ae81ff>22</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |<span style=color:#f92672>(</span>........<span style=color:#e6db74>&#34;......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  b6 2b 00 00 00 00 00 00  |(........+......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  d6 41 00 00 00 00 00 00  |(........A......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  fd 21 00 00 00 00 00 00  |(........!......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  e1 25 00 00 00 00 00 00  |(........%......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  f5 31 00 00 00 00 00 00  |(........1......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  1e 42 00 00 00 00 00 00  |(........B......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000020  28 00 00 00 00 00 00 00  70 42 02 00 00 00 00 00  |(.......pB......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[...]
</span></span></span></code></pre></div><p>So here, we have two 64-bit integers. The first one is <code>28 00 00 00 00 00 00 00</code> and always has the same value. Not sure what it represents; the value is somewhat close to the header size in bytes: 40 for this value, 56 for the full header size.</p><p>Maybe the header could vary in size in certain situations, and this represents its size minus some fixed part (like the first 16 bytes/128 bits). I&rsquo;m also kind of betting that if the previous 64-bit integer (<code>01 00 00 00 00 00 00 00</code>) changes, this will also change.</p><p>But as it never varies in the set of index files we have here, we cannot really make any deduction, only guesses. So once again, let&rsquo;s ignore it.</p><p>At this point, the idea of downloading other Wargaming games like World of Tanks or World of Warplanes popped up; maybe this will give complementary information regarding the unknown fields that start to pile up.</p><p>But let&rsquo;s continue for now.</p><p>EDIT: It&rsquo;s no help; World of Tanks and World of Warplanes simply pack their resources in <code>.zip</code> files&mldr;
It&rsquo;s a wild guess, but I kind of expect WoWs to be the same in the future.
The WoWs packing format feels, in fact, somewhat legacy, custom, and far less efficient than a standard run-of-the-mill <code>.zip</code> file. Not to mention using <code>.zip</code> files means removing one bit of code to maintain.</p><p>The next value is again a 64-bit integer; it changes between each file.</p><p>Let&rsquo;s focus on one file:</p><pre tabindex=0><code>[...]
00000020  28 00 00 00 00 00 00 00  f6 3b 00 00 00 00 00 00  |(........;......|
[...]
</code></pre><p>At first, I thought it might be a file size, but quickly checking the index file size, I got:</p><ul><li>index file size: 29043</li><li>value of this field in decimal: 15350</li></ul><p>Checking another file, I got 77461 and 44807.</p><p>So no, it&rsquo;s not the index size. However it is suspiciously ~1/2 of the file size, and after having stared at hexdumps for hours, I had another idea.</p><p>The third chunk of the file is right after the bundle of dir/file name strings which varies in length wildly (i.e., it&rsquo;s not a fixed length or a multiple of a fixed length).</p><p>We probably need an offset pointing to the start of this section in the header.</p><p>And sure enough, looking where the bundle of strings stops, we get:</p><pre tabindex=0><code>00003bd0  6f 69 73 65 2e 64 64 73  00 73 70 61 63 65 5f 76  |oise.dds.space_v|
00003be0  61 72 69 61 74 69 6f 6e  5f 64 75 6d 6d 79 2e 64  |ariation_dummy.d|
00003bf0  64 73 00 77 61 76 65 73  5f 68 65 69 67 68 74 73  |ds.waves_heights|
00003c00  30 2e 64 64 73 00 8f ec  87 4a 28 d0 f7 c7 70 11  |0.dds....J(...p.|
00003c10  03 07 0d 33 ed 77 1e 9b  ef 05 00 00 00 00 05 00  |...3.w..........|
</code></pre><p>Okay, the string bundle ends at 00003c05; that&rsquo;s quite near 3bf6, so this is certainly the offset to this third section or the end of the bundle of strings.</p><p>Most likely, the offset is not from the start of the file but from a specific point in the header (this field? end of header?); that&rsquo;s why we get a -15 difference (0x00003c05 - 0x3bf6 = 0xF = 15). This -15 value is constant between files.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| HS | HS | HS | HS | HS | HS | HS | HS || OF | OF | OF | OF | OF | OF | OF | OF |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;------------ header size (?) --------&gt;||&lt;---- offset third section start -----&gt;|
</code></pre><p>Last 64 bits:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6623042/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n <span style=color:#ae81ff>4</span> | tail -n 1;<span style=color:#66d9ef>done</span> | less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  <span style=color:#ae81ff>40</span> af <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  1b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |@...............|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  <span style=color:#ae81ff>54</span> 8d 1f <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>21</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |T.......!.......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  8e ae <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>81</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  c9 <span style=color:#ae81ff>24</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  1f <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |.$..............|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>So, we have a 64-bit integer, which is a relatively low value. This means it&rsquo;s most likely a size or an offset.</p><p>If we pick one:</p><pre tabindex=0><code>hexdump -C system_data.idx | less
[...]
00000030  36 71 00 00 00 00 00 00  13 00 00 00 00 00 00 00  |6q..............|
[...]
</code></pre><p>We can see that the <code>36 71 00 00 00 00 00 00</code>, 28982 once converted to decimal, is remarkably close to the file size (29043 bytes).</p><p>From there, we can guess it might be three things:</p><ul><li>the actual index file size</li><li>an offset to something at the end of the file</li><li>pointer to the end of the third section</li></ul><p>Let&rsquo;s note that for now, and figure out the finer details at implementation time.</p><p>So, to recap, here is the header section format:</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| MA | MA | MA | MA || 00 | 00 | 00 | 02 || ID | ID | ID | ID || 40 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;----- magic -----&gt;||&lt;----- ???? ------&gt;||&lt;---- id/crc -----&gt;||&lt;----- ??????? ---&gt;|

+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| FD | FD | FD | FD || FI | FI | FI | FI || 01 | 00 | 00 | 00 || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;file + dir count &gt;||&lt;-- file count ---&gt;||&lt;-------------- ???? ------------------&gt;|

+====+====+====+====+====+====+====+=====++=====+====+====+====+====+====+====+====+
| HS | HS | HS | HS | HS | HS | HS | HS  ||  OF | OF | OF | OF | OF | OF | OF | OF |
+====+====+====+====+====+====+====+=====++=====+====+====+====+====+====+====+====+
|&lt;------------ header size (?) ---------&gt;||&lt;----- offset third section start -----&gt;|

+====+====+====+====+====+====+====+=====+
| OE | OE | OE | OE | OE | OE | OE | OE  |
+====+====+====+====+====+====+====+=====+
|&lt;---- offset third section end --------&gt;|
</code></pre><h2 id=filename-section>Filename Section</h2><p>Not much to say there.</p><p>Here&rsquo;s what it looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx| less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002700</span>  fb <span style=color:#ae81ff>14</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>74</span> d1 1b 8d f4 ff 7a ce  |........t.....z.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002710</span>  a4 eb 1b 3e <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>21</span> d8 <span style=color:#ae81ff>74</span>  4b <span style=color:#ae81ff>44</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>74</span> 6f <span style=color:#ae81ff>72</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>67</span>  |...&gt;P!.tKDStorag|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002720</span>  <span style=color:#ae81ff>65</span> 2e <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>69</span> 6e <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>61</span>  <span style=color:#ae81ff>76</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>73</span> 5f <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>67</span>  |e.bin.waves_heig|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002730</span>  <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>31</span> 2e <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>61</span> 6e <span style=color:#ae81ff>69</span> 6d <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>65</span>  |hts1.dds.animate|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>000028c0  <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>73</span> 2e <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>69</span> 6e <span style=color:#ae81ff>00</span> 6d  <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>69</span>  |ts.bin.miscSetti|
</span></span><span style=display:flex><span>000028d0  6e <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>73</span> 2e <span style=color:#ae81ff>78</span> 6d 6c <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>61</span> 6d <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>65</span> 5f <span style=color:#ae81ff>64</span>  |ngs.xml.damage_d|
</span></span><span style=display:flex><span>000028e0  <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>63</span> 5f <span style=color:#ae81ff>32</span> 5f <span style=color:#ae81ff>64</span> 2e <span style=color:#ae81ff>64</span>  <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>32</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>61</span> 6d <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>67</span>  |ec_2_d.dd2.damag|
</span></span><span style=display:flex><span>000028f0  <span style=color:#ae81ff>65</span> 5f <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>63</span> 5f <span style=color:#ae81ff>31</span> 5f  <span style=color:#ae81ff>65</span> 2e <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>72</span>  |e_dec_1_e.dds.cr|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>00003be0  <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>72</span> <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>69</span> 6f 6e  5f <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>75</span> 6d 6d <span style=color:#ae81ff>79</span> 2e <span style=color:#ae81ff>64</span>  |ariation_dummy.d|
</span></span><span style=display:flex><span>00003bf0  <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>76</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>73</span>  5f <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>73</span>  |ds.waves_heights|
</span></span><span style=display:flex><span>00003c00  <span style=color:#ae81ff>30</span> 2e <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span> 8f 0c  9a ba 4f <span style=color:#ae81ff>40</span> b6 <span style=color:#ae81ff>93</span> <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |0.dds.....O@..p.|
</span></span><span style=display:flex><span>00003c10  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w..........|
</span></span><span style=display:flex><span>00003c20  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> f5 <span style=color:#ae81ff>21</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> bf <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>45</span> 5c 6c <span style=color:#ae81ff>36</span>  |.......!....E<span style=color:#ae81ff>\l</span>6|
</span></span></code></pre></div><p>So it&rsquo;s a bunch of <code>\0</code> separated strings. The only thing interesting to note is that it&rsquo;s not a fixed size section.</p><h2 id=pkg-pointer-section>PKG Pointer Section</h2><p>Here what it looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx| less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>00003bf0  <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>76</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>73</span>  5f <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>73</span>  |ds.waves_heights|
</span></span><span style=display:flex><span>00003c00  <span style=color:#ae81ff>30</span> 2e <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span> 8f 0c  9a ba 4f <span style=color:#ae81ff>40</span> b6 <span style=color:#ae81ff>93</span> <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |0.dds.....O@..p.|
</span></span><span style=display:flex><span>00003c10  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w..........|
</span></span><span style=display:flex><span>00003c20  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> f5 <span style=color:#ae81ff>21</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> bf <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>45</span> 5c 6c <span style=color:#ae81ff>36</span>  |.......!....E<span style=color:#ae81ff>\l</span>6|
</span></span><span style=display:flex><span>00003c30  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 8f ec  <span style=color:#ae81ff>87</span> 4a <span style=color:#ae81ff>28</span> d0 f7 c7 <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |.........J<span style=color:#f92672>(</span>...p.|
</span></span><span style=display:flex><span>00003c40  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> 1e 9b  ef <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w..........|
</span></span><span style=display:flex><span>00003c50  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>15</span>  <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>97</span> 3e ab  |...........wc.&gt;.|
</span></span><span style=display:flex><span>00003c60  <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> ad <span style=color:#ae81ff>70</span>  a2 e7 ac 2c 4f 6b <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |.......p...,Okp.|
</span></span><span style=display:flex><span>00003c70  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>22</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w.<span style=color:#e6db74>&#34;........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c80  00 00 01 00 00 00 cb 01  00 00 6d b9 de c1 ad 0c  |..........m.....|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003c90  00 00 00 00 00 00 8e c7  6a 58 7c 86 62 33 70 11  |........jX|.b3p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003ca0  03 07 0d 33 ed 77 e0 23  00 00 00 00 00 00 05 00  |...3.w.#........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003cb0  00 00 01 00 00 00 65 00  00 00 f1 d2 87 5a d2 00  |......e......Z..|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003cc0  00 00 00 00 00 00 8e 43  3d e9 cf 49 52 a4 70 11  |.......C=..IR.p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003cd0  03 07 0d 33 ed 77 4d 1f  6a 05 00 00 00 00 05 00  |...3.wM.j.......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003ce0  00 00 01 00 00 00 bb 19  00 00 f7 53 4a b1 38 ab  |...........SJ.8.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00003cf0  00 00 00 00 00 00 0e 3c  9a 6d 22 de 7b da 70 11  |.......&lt;.m&#34;</span>.<span style=color:#f92672>{</span>.p.|
</span></span><span style=display:flex><span>00003d00  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>55</span> <span style=color:#ae81ff>24</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.wU$........|
</span></span><span style=display:flex><span>00003d10  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>72</span> 0d  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>83</span> 0a <span style=color:#ae81ff>72</span> <span style=color:#ae81ff>88</span> a3 5c  |......r.....r..<span style=color:#ae81ff>\|</span>
</span></span><span style=display:flex><span>00003d20  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>98</span> <span style=color:#ae81ff>45</span>  <span style=color:#ae81ff>00</span> 7a <span style=color:#ae81ff>16</span> 6e <span style=color:#ae81ff>84</span> <span style=color:#ae81ff>21</span> <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |.......E.z.n.!p.|
</span></span><span style=display:flex><span>00003d30  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>73</span> ce  cb <span style=color:#ae81ff>06</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.ws.........|
</span></span><span style=display:flex><span>00003d40  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> f9 b6  b7 <span style=color:#ae81ff>00</span> ff 7e f7 7b 5b <span style=color:#ae81ff>30</span>  |...........~.<span style=color:#f92672>{[</span>0|
</span></span><span style=display:flex><span>00003d50  b8 <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>98</span> <span style=color:#ae81ff>51</span>  4a <span style=color:#ae81ff>00</span> 2c <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>71</span> ad <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |.......QJ.,.q.p.|
</span></span><span style=display:flex><span>00003d60  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span> 7e <span style=color:#ae81ff>63</span>  <span style=color:#ae81ff>75</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span>  |...3.w~cu.......|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007100</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 6f <span style=color:#ae81ff>09</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> fc <span style=color:#ae81ff>56</span> <span style=color:#ae81ff>94</span> f8 9a <span style=color:#ae81ff>37</span>  |......o....V...7|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00007110</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>21</span> <span style=color:#ae81ff>67</span>  ac <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>22</span> ec ca b8 <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span>  |......!g.p<span style=color:#e6db74>&#34;...p.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007120  03 07 0d 33 ed 77 28 f9  15 0a 00 00 00 00 05 00  |...3.w(.........|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007130  00 00 01 00 00 00 0b 2d  00 00 03 bd b0 50 67 e9  |.......-.....Pg.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007140  00 00 00 00 00 00 15 00  00 00 00 00 00 00 18 00  |................|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007150  00 00 00 00 00 00 70 11  03 07 0d 33 ed 77 73 79  |......p....3.wsy|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007160  73 74 65 6d 5f 64 61 74  61 5f 30 30 30 31 2e 70  |stem_data_0001.p|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007170  6b 67 00                                          |kg.|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00007173
</span></span></span><span style=display:flex><span><span style=color:#e6db74>(END)
</span></span></span></code></pre></div><p>This section contains 384-bit records (48 bytes each) linking files to their data in <code>.pkg</code> files through IDs and offsets.</p><p>Each record contains metadata IDs, PKG file offsets, data sizes, and compression types.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># let&#39;s skip the first 6 bytes to align hexdump output</span>
</span></span><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -s <span style=color:#ae81ff>6</span> -C system_data.idx| less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>00003be6  6f 6e 5f <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>75</span> 6d 6d <span style=color:#ae81ff>79</span>  2e <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>76</span>  |on_dummy.dds.wav|
</span></span><span style=display:flex><span>00003bf6  <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>73</span> 5f <span style=color:#ae81ff>68</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>68</span>  <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>30</span> 2e <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>00</span>  |es_heights0.dds.|
</span></span><span style=display:flex><span>00003c06  8f 0c 9a ba 4f <span style=color:#ae81ff>40</span> b6 <span style=color:#ae81ff>93</span>  <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span>  |....O@..p....3.w|
</span></span><span style=display:flex><span>00003c16  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span>00003c26  f5 <span style=color:#ae81ff>21</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> bf <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>45</span> 5c  6c <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |.!....E<span style=color:#ae81ff>\l</span>6......|
</span></span><span style=display:flex><span>00003c36  8f ec <span style=color:#ae81ff>87</span> 4a <span style=color:#ae81ff>28</span> d0 f7 c7  <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span>  |...J<span style=color:#f92672>(</span>...p....3.w|
</span></span><span style=display:flex><span>00003c46  1e 9b ef <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>05</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |................|
</span></span><span style=display:flex><span>00003c56  <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>97</span>  3e ab <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |.....wc.&gt;.......|
</span></span><span style=display:flex><span>00003c66  ad <span style=color:#ae81ff>70</span> a2 e7 ac 2c 4f 6b  <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>07</span> 0d <span style=color:#ae81ff>33</span> ed <span style=color:#ae81ff>77</span>  |.p...,Okp....3.w|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Much nicer!</p><p>With that, we immediately notice a cycle, with the <code>70 11 03 07 0d 33 ed 77</code> value.</p><p>There are 6 × 64 = 384 bits between each <code>70 11 03 07 0d 33 ed 77</code> value.</p><p>Let&rsquo;s try to confirm that with the IDs.</p><p>We are spotting the <code>bf 00 45 5c 6c 36</code> seen previously in the <code>.pkg</code> file. 384 bits later, we see <code>03 77 63 97 3e ab 02</code>.</p><p>With a bit of digging (it&rsquo;s right in the middle of the <code>.pkg</code> file, and this ID is not neatly in a 64-bit aligned chunk because of the variable size of the DEFLATE blocks), we indeed find it.</p><p>We have indeed a 384-bit cycle, which neatly fits in 3 lines of hexdump!</p><p>So each of these is one record:</p><pre tabindex=0><code>00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
00003c16  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
</code></pre><pre tabindex=0><code>00003c36  8f ec 87 4a 28 d0 f7 c7  70 11 03 07 0d 33 ed 77  |...J(...p....3.w|
00003c46  1e 9b ef 05 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c56  15 15 01 00 03 77 63 97  3e ab 02 00 00 00 00 00  |.....wc.&gt;.......|
</code></pre><pre tabindex=0><code>00003c66  ad 70 a2 e7 ac 2c 4f 6b  70 11 03 07 0d 33 ed 77  |.p...,Okp....3.w|
00003c76  05 22 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |.&#34;..............|
00003c86  cb 01 00 00 6d b9 de c1  ad 0c 00 00 00 00 00 00  |....m...........|
</code></pre><pre tabindex=0><code>00003c96  8e c7 6a 58 7c 86 62 33  70 11 03 07 0d 33 ed 77  |..jX|.b3p....3.w|
00003ca6  e0 23 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |.#..............|
00003cb6  65 00 00 00 f1 d2 87 5a  d2 00 00 00 00 00 00 00  |e......Z........|
</code></pre><pre tabindex=0><code>00003cc6  8e 43 3d e9 cf 49 52 a4  70 11 03 07 0d 33 ed 77  |.C=..IR.p....3.w|
00003cd6  4d 1f 6a 05 00 00 00 00  05 00 00 00 01 00 00 00  |M.j.............|
00003ce6  bb 19 00 00 f7 53 4a b1  38 ab 00 00 00 00 00 00  |.....SJ.8.......|
</code></pre><p>All these records are from the same file,</p><p>let&rsquo;s grab a few from other files:</p><p>File 2:</p><pre tabindex=0><code>0000f6fd  58 fe 65 b4 59 b6 b0 77  a4 8c 78 6a 58 aa 65 84  |X.e.Y..w..xjX.e.|
0000f70d  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
0000f71d  bc 99 05 00 f4 3a 67 8b  80 00 08 00 00 00 00 00  |.....:g.........|
</code></pre><pre tabindex=0><code>0000f72d  a0 e5 c7 22 cc 49 d3 31  a4 8c 78 6a 58 aa 65 84  |...&#34;.I.1..xjX.e.|
0000f73d  3e 9e 7e 05 00 00 00 00  05 00 00 00 01 00 00 00  |&gt;.~.............|
0000f74d  79 c6 03 00 dc b8 5f 80  80 00 08 00 00 00 00 00  |y....._.........|
</code></pre><p>File 3:</p><pre tabindex=0><code>00002d0c  ed cf 33 f8 a5 94 53 56  0d a7 9c b9 bf 60 f5 3e  |..3...SV.....`.&gt;|
00002d1c  40 a8 08 07 00 00 00 00  00 00 00 00 00 00 00 00  |@...............|
00002d2c  38 ab 00 00 5d cf 4e b6  38 ab 00 00 00 00 00 00  |8...].N.8.......|
</code></pre><pre tabindex=0><code>00002d3c  ed ea da 52 4e 8f 70 ed  0d a7 9c b9 bf 60 f5 3e  |...RN.p......`.&gt;|
00002d4c  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00002d5c  98 00 00 00 a4 63 f2 9b  98 00 00 00 00 00 00 00  |.....c..........|
</code></pre><p>Lets study:</p><pre tabindex=0><code>00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
00003c16  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
</code></pre><p>For the first 128 bits we get:</p><pre tabindex=0><code>00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
</code></pre><p>From the fact the last 64 bits are constant, we can deduce we have probably two 64 bits integers in the first 128 bits</p><p>Once again, these are using all the available bits and seem rather random. It&rsquo;s difficult to link these to their role, so&mldr; lets simply ignore these for now.</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| UO | UO | UO | UO | UO | UO | UO | UO || UT | UT | UT | UT | UT | UT | UT | UT |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;------------ unknown 1 --------------&gt;||&lt;------------- unknow 2 --------------&gt;|
|               64 bits                 ||               64 bits                 |
</code></pre><p>Next 64 bits, we have a low value 64 bits integer, so most likely an offset. It is also suspiciously at <code>0x0</code> for the first record which is also the first data chunk in the <code>.pkg</code> file.</p><p>So, it&rsquo;s most likely the start of a data chunk in a <code>.pkg</code> file. Looking at other records confirms that.</p><p>Next, we have two extremely low value 32 bits (0x5 and 0x1). So once again, most likely some kind of enum, lets call them <code>type1</code> and <code>type2</code>.</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
| OF | OF | OF | OF | OF | OF | OF | OF || T1 | T1 | T1 | T1 || T2 | T2 | T2 | T2 |
+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;----------start offset pkg ----------&gt;||&lt;---- type 1 -----&gt;||&lt;----- type 2 ----&gt;|
|               64 bits                 ||     32 bits       ||      32 bits      |
</code></pre><p>For the Last 128 bits, we get the following:</p><pre tabindex=0><code>00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
</code></pre><p>So, here, we see our <code>.pkg</code> ID (<code>bf 00 45 5c 6c 36</code>) right in the middle. Given its size, this ID is probably stored on 64 bits.</p><p>After that, last 32 bits, we get a bunch of <code>00</code>, maybe a reserved field, but more likely some kind of padding.</p><p>Before that, we get a low value 32 bits integer. When comparing with the <code>.pkg</code> file, <code>f5 21 00 00</code> is the offset where the first data chunk ends.</p><p>So it&rsquo;s the end offset. But 32 bits seems rather small to store such offset (specially given the start offset is 64 bits. Also, for other data chunks, this doesn&rsquo;t line-up.</p><p>However, it could very much be a relative offset (to the start of the data chunk).</p><p>Lets validate that with the second record</p><p>Record</p><pre tabindex=0><code>00003c36  8f ec 87 4a 28 d0 f7 c7  70 11 03 07 0d 33 ed 77  |...J(...p....3.w|
00003c46  1e 9b ef 05 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c56  15 15 01 00 03 77 63 97  3e ab 02 00 00 00 00 00  |.....wc.&gt;.......|
</code></pre><p>More hexdump! (searching the data chunk using the <code>03 77 63 97 3e ab 02</code> ID and the start offset <code>1e 9b ef 05 00 00 00 00</code>, or <code>0x05ef9b1e</code> once we take endianess into account):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux World of Warships/res_packages » hexdump -C system_data_0001.pkg | less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>05ef9b10  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>17</span> 4b <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>42</span> <span style=color:#ae81ff>80</span> <span style=color:#ae81ff>40</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 8c 7d  |...K<span style=color:#f92672>(</span>B.@.......<span style=color:#f92672>}</span>|
</span></span><span style=display:flex><span>05ef9b20  3b <span style=color:#ae81ff>50</span> 5d d9 b6 dd 7d b6  3e <span style=color:#ae81ff>76</span> <span style=color:#ae81ff>15</span> b2 5f <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>89</span> <span style=color:#ae81ff>04</span>  |;P<span style=color:#f92672>]</span>...<span style=color:#f92672>}</span>.&gt;v.._ ..|
</span></span><span style=display:flex><span>05ef9b30  <span style=color:#ae81ff>55</span> bd <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>44</span> <span style=color:#ae81ff>82</span> aa ec 7a  9c bd f7 <span style=color:#ae81ff>79</span> <span style=color:#ae81ff>45</span> <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>39</span> <span style=color:#ae81ff>40</span>  |U..D...z...yEW9@|
</span></span><span style=display:flex><span>05ef9b40  <span style=color:#ae81ff>90</span> d0 4e 8c c0 <span style=color:#ae81ff>01</span> 9d <span style=color:#ae81ff>21</span>  <span style=color:#ae81ff>48</span> e8 0c <span style=color:#ae81ff>41</span> a2 ce <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>24</span>  |..N....!H..A...$|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>05f0b010  d1 d7 <span style=color:#ae81ff>52</span> b0 de cc fa 9c  2b 8d b5 <span style=color:#ae81ff>57</span> a4 <span style=color:#ae81ff>02</span> ff 1a  |..R.....+..W....|
</span></span><span style=display:flex><span>05f0b020  <span style=color:#ae81ff>43</span> 5d 2d <span style=color:#ae81ff>43</span> 3f cc d1 0b  f8 <span style=color:#ae81ff>88</span> <span style=color:#ae81ff>92</span> a8 9f 5a <span style=color:#ae81ff>70</span> <span style=color:#ae81ff>64</span>  |C<span style=color:#f92672>]</span>-C?........Zpd|
</span></span><span style=display:flex><span>05f0b030  <span style=color:#ae81ff>46</span> fb 7f <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>03</span>  <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>97</span> 3e ab <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |F.......wc.&gt;....|
</span></span><span style=display:flex><span>05f0b040  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>94</span> b7 <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>90</span> db  <span style=color:#ae81ff>68</span> 9e e6 d9 1f <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>62</span> 6f  |.....g..h....6bo|
</span></span><span style=display:flex><span>05f0b050  6f <span style=color:#ae81ff>22</span> <span style=color:#ae81ff>76</span> f6 <span style=color:#ae81ff>62</span> e3 <span style=color:#ae81ff>62</span> <span style=color:#ae81ff>77</span>  <span style=color:#ae81ff>67</span> 7a 7a ba ab bb 8c aa  |o<span style=color:#e6db74>&#34;v.b.bwgzz.....|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>05f0b060  4a 52 95 5c ca a5 cf 64  d2 24 bd 27 41 d0 00 04  |JR.\...d.</span>$<span style=color:#e6db74>.&#39;A...|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[...]
</span></span></span></code></pre></div><p>We indeed find the start of our data chunk at <code>05ef9b1e</code> (<code>8c</code> after a bunch of <code>00</code> on the first line).</p><p>And looking for the <code>00 00 00 00 ID ID [...]</code> pattern in between the data chunks, we can determine the end of this chunk to be at <code>0x05f0b032</code>.</p><p>Doing <code>0x05f0b032 - 0x05ef9b1e</code>, we get <code>0x11514</code>, that&rsquo;s almost our <code>15 15 01 00</code> once we swap endianess, and add <code>1</code>.</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
| OE | OE | OE | OE || ID | ID | ID | ID | ID | ID | ID | ID || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
|&lt;-- offset end ---&gt;||&lt;------------- ID &#39;.pkg&#39; -------------&gt;||&lt;---- padding ----&gt;|
|     32 bits       ||               64 bits                 ||      32 bits      |
</code></pre><p>So to recap, we have:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
| UO | UO | UO | UO | UO | UO | UO | UO ||  UT | UT | UT | UT | UT | UT | UT | UT |
+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
|&lt;------------ unknown 1 --------------&gt;||&lt;-------------- unknown 2 -------------&gt;|
|               64 bits                 ||                64 bits                 |
+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
| OF | OF | OF | OF | OF | OF | OF | OF || T1 | T1 | T1 | T1 || T2 | T2 | T2 | T2 |
+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;--------- start offset pkg ----------&gt;||&lt;---- type 1 -----&gt;||&lt;----- type 2 ----&gt;|
|               64 bits                 ||     32 bits       ||      32 bits      |
+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
| OE | OE | OE | OE || ID | ID | ID | ID | ID | ID | ID | ID || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
|&lt;-- offset end ---&gt;||&lt;------------- ID &#39;.pkg&#39; -------------&gt;||&lt;---- padding ----&gt;|
|     32 bits       ||               64 bits                 ||      32 bits      |
</code></pre><h2 id=the-last-bits>The Last Bits</h2><p>So, okay, we have the core of the 3 parts of the file.</p><p>But we can see the last few bits don&rsquo;t follow this pattern (especially with the <code>.pkg</code> file name), which means we have a footer:</p><pre tabindex=0><code># Last block
00007116  21 67 ac 70 22 ec ca b8  70 11 03 07 0d 33 ed 77  |!g.p&#34;...p....3.w|
00007126  28 f9 15 0a 00 00 00 00  05 00 00 00 01 00 00 00  |(...............|
00007136  0b 2d 00 00 03 bd b0 50  67 e9 00 00 00 00 00 00  |.-.....Pg.......|
# Footer
00007146  15 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|
00007156  70 11 03 07 0d 33 ed 77  73 79 73 74 65 6d 5f 64  |p....3.wsystem_d|
00007166  61 74 61 5f 30 30 30 31  2e 70 6b 67 00           |ata_0001.pkg.|
</code></pre><p>If we look at the content, we have 3 × 64 bits before the name starts (<code>73 79 73 74 65 6d 5f 64</code> for <code>system_d</code>)</p><p>Looking at it more closely, given all the <code>00</code>, it seems we have three 64-bit integers there.</p><ul><li><code>15 00 00 00 00 00 00 00</code></li><li><code>18 00 00 00 00 00 00 00</code></li><li><code>70 11 03 07 0d 33 ed 77</code></li></ul><p><code>70 11 03 07 0d 33 ed 77</code> is the &ldquo;unknown 2&rdquo; we saw previously, so still no luck, but let&rsquo;s name it the same way.</p><p><code>18 00 00 00 00 00 00 00</code> seems to have the same value across all files, so probably not that important.</p><p>The only one that varies across files is the <code>15 00 00 00 00 00 00 00</code>, but always in the same kind of values around 0x15. In decimal it&rsquo;s 21.</p><p>Strangely, <code>system_data_0001.pkg</code> is 20 chars long, 21 if we include the <code>\0</code> at the end.</p><p>So we can deduce it&rsquo;s actually the <code>.pkg</code> file name string size.</p><p>So we have</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
| UO | UO | UO | UO | UO | UO | UO | UO ||  U3 | U3 | U3 | U3 | U3 | U3 | U3 | U3 |
+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
|&lt;--------- size pkg file name --------&gt;||&lt;-------------- unknown 3 -------------&gt;|
|               64 bits                 ||                64 bits                 |
+=====+====+====+====+====+====+====+====+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
|  UT | UT | UT | UT | UT | UT | UT | UT |             file name string
+=====+====+====+====+====+====+====+====+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
|&lt;-------------- unknown 2 -------------&gt;|
|                64 bits                 |
</code></pre><h1 id=recap-part-2>Recap (Part 2)</h1><ul><li>Identified <code>.idx</code> files in <code>./bin/&lt;latest>/idx/</code> as indexes for <code>.pkg</code> archives and matched them by name.</li><li>Mapped overall <code>.idx</code> layout into 4 parts:<ul><li>Header: magic <code>ISFP</code>, counts (entries and files), header-size-like field, offsets to start/end of the third section, and a per-file id/crc-like value.</li><li>Names: <code>\0</code>-separated file and directory names.</li><li>Records section (per-record 384 bits): two 64-bit unknowns (likely ids, one enabling parent/child hierarchy), 64-bit start offset in <code>.pkg</code>, 2×32-bit types, 32-bit relative end size, 64-bit <code>.pkg</code> chunk id, and padding.</li><li>Footer: <code>.pkg</code> filename length, an unknown 64-bit value, a repeated 64-bit constant, then the <code>.pkg</code> filename string.</li></ul></li><li>Established the link between names and <code>.pkg</code> chunks via IDs and offsets, enough to reconstruct directories and locate data.</li></ul><p>In <a href=/posts/wows_depack_part3/>the next part</a> of this series we will start the actual implementation.</p><div class=related></div></div></div></section><script src=/js/copycode.js></script><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/kakwa>Pierre-Francois Carpentier</a> 2024</p></div></section></body></html>