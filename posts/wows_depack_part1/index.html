<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Reversing WoWs Resource Format - Part 1: Searching The Data | Technically some technical stuff, or not.</title>
<meta property='og:title' content='Reversing WoWs Resource Format - Part 1: Searching The Data - Technically some technical stuff, or not.'><meta property='og:description' content='Parts Part 1 — Searching The Data → /posts/wows_depack_part1/ Part 2 — Getting The Metadata → /posts/wows_depack_part2/ Part 3 — Reading The Database → /posts/wows_depack_part3/ Part 4 — Tidying-Up The Project → /posts/wows_depack_part4/ Introduction Firstly, a disclaimer: this is the first time I&rsquo;m doing this kind of exercise, so the process described here is far from ideal, and the tools used are probably less than adequate.
Also, I&rsquo;m writing this after various findings, so the process seems quite straightforward.'><meta property='og:url' content='https://technically.kakwalab.ovh/posts/wows_depack_part1/'><meta property='og:site_name' content='Technically some technical stuff, or not.'><meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/bf9868bd766533e965b2eb1ed2d4ef76?s=256'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2025-08-27T00:00:00+02:00'><meta property='article:modified_time' content='2025-08-27T00:00:00+02:00'><meta name=twitter:card content='summary'><meta name=twitter:site content='@'><meta name=twitter:creator content='@'><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://technically.kakwalab.ovh/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://technically.kakwalab.ovh/posts/wows_depack_part1/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://technically.kakwalab.ovh/><h1 id=nav-heading class="title is-4">Technically some technical stuff, or not.</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/kakwa target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</i></span></a><a class=level-item aria-label=mastodon href=https://mastodon.instance/@kakwa target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M11.966876.80329086C9.1123466.82665791 6.3664935 1.1367094 4.7662978 1.8737549c0 0-3.1736685 1.4237835-3.1736685 6.2815982.0 1.1123884-.021554 2.4424309.013571 3.8529439.1152443 4.750677.8683725 9.432704 5.2479219 10.595273 2.0193066.53604 3.7531218.648348 5.1494078.571373 2.532141-.140797 3.953603-.906282 3.953603-.906282l-.08353-1.842608s-1.809527.572181-3.841713.50245c-2.013417-.06922-4.138986-.217713-4.4646269-2.696937-.030082-.217772-.045075-.450712-.045075-.695267.0.0 1.9765387.484554 4.4813709.599656 1.531629.07049 2.9679-.08996 4.426746-.264563 2.797636-.335045 5.233581-2.063856 5.539741-3.643517.482392-2.488386.442651-6.0725219.442651-6.0725219.0-4.8578147-3.173492-6.2815982-3.173492-6.2815982C17.639136 1.1367094 14.891579.82669685 12.03704.80329086z"/><path d="M6.4286668 14.016701V9.1034254c0-1.0041614.2549569-1.8022059.7670342-2.3925638.5280486-.590366 1.2196579-.8929946 2.0781049-.8929946.9931961.0 1.7452181.3828583 2.2425191 1.1486808L11.999859 7.7793695 12 11.451148 11.999859 7.7793695l.483533-.8128217c.497204-.7658225 1.249226-1.1486808 2.242528-1.1486808.858341.0 1.549951.3026286 2.078097.8929946.511971.5903579.766887 1.3884024.766887 2.3925638v4.9132756"/></svg>
</i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/pfcarpentier target=_blank rel='me noopener'><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"></div><h2 class="subtitle is-6">August 27, 2025</h2><h1 class=title>Reversing WoWs Resource Format - Part 1: Searching The Data</h1><div class=content><h1 id=parts>Parts</h1><ul><li>Part 1 — Searching The Data → <a href=/posts/wows_depack_part1/>/posts/wows_depack_part1/</a></li><li>Part 2 — Getting The Metadata → <a href=/posts/wows_depack_part2/>/posts/wows_depack_part2/</a></li><li>Part 3 — Reading The Database → <a href=/posts/wows_depack_part3/>/posts/wows_depack_part3/</a></li><li>Part 4 — Tidying-Up The Project → <a href=/posts/wows_depack_part4/>/posts/wows_depack_part4/</a></li></ul><h1 id=introduction>Introduction</h1><p>Firstly, a disclaimer: this is the first time I&rsquo;m doing this kind of exercise, so the process described here is far from ideal, and the tools used are probably less than adequate.</p><p>Also, I&rsquo;m writing this after various findings, so the process seems quite straightforward. In reality, it was full of dead ends and flows of ideas (good and bad) that came up while staring at hexdumps for hours.</p><h2 id=motivation>Motivation</h2><p>I&rsquo;ve always wanted to play around with World of Warships game content for various reasons, from extracting things like armor layouts or in-game parameters to the 3D models themselves.</p><p>There is already a closed-source Windows tool doing that: <a href=https://forum.worldofwarships.eu/topic/113847-all-wows-unpack-tool-unpack-game-client-resources/>wows-unpack</a></p><p>But being a pro-OSS Linux user, this tool doesn&rsquo;t suit me well as it is annoying to use (<code>Wine</code>) and cannot be readily integrated into other programs.</p><p>I also wanted to do it as an intellectual & learning exercise of reverse engineering.</p><h2 id=goals>Goals</h2><ul><li>Reverse engineer the format sufficiently for data extraction</li><li>Document the specification for others to build upon</li><li>Create an OSS CLI tool</li><li>Develop a reusable OSS library</li></ul><h1 id=reverse-engineering-process>Reverse Engineering Process</h1><h2 id=initial-analysis>Initial Analysis</h2><h3 id=game-file-structure>Game File Structure</h3><p>Unfortunately, I only have very fuzzy memories of the initial steps I took since they came from an initial effort 2 years before the bulk of the reversing.</p><p>The gist of it was to look at the game files and see where most of the data was:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux Games/World of Warships » ls
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> api-ms-win-crt-runtime-l1-1-0.dll  concrt140.dll             msvcp140_codecvt_ids.dll  Reports               vcruntime140_1.dll
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> api-ms-win-crt-stdio-l1-1-0.dll    crashes                   msvcp140.dll              res_packages          vcruntime140.dll
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> api-ms-win-crt-time-l1-1-0.dll     GameCheck                 placeholder.txt           screenshot            WorldOfWarships.exe
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span> bin                                msvcp140_atomic_wait.dll  replays                   user_preferences.xml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kakwa@linux Games/World of Warships » du -hd <span style=color:#ae81ff>1</span> | sort -h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>4.0K  ./Reports
</span></span><span style=display:flex><span>12K   ./patche
</span></span><span style=display:flex><span>2.8M  ./Wallpapers
</span></span><span style=display:flex><span>4.2M  ./GameCheck
</span></span><span style=display:flex><span>4.4M  ./screenshot
</span></span><span style=display:flex><span>49M   ./replays
</span></span><span style=display:flex><span>55M   ./lib
</span></span><span style=display:flex><span>464M  ./profile
</span></span><span style=display:flex><span>593M  ./crashes
</span></span><span style=display:flex><span>1.2G  ./bin
</span></span><span style=display:flex><span>62G   ./res_packages
</span></span><span style=display:flex><span>73G  .
</span></span></code></pre></div><p>So here, most of the data is in the <code>res_packages/</code> directory. Let&rsquo;s take a closer look:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux Games/World of Warships » ls res_packages
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>spaces_dock_1_april_0001.pkg          spaces_faroe_0001.pkg                spaces_ridge_0001.pkg
</span></span><span style=display:flex><span>vehicles_level10_panamerica_0001.pkg  vehicles_level3_panasia_0001.pkg     vehicles_level6_jap_0001.pkg
</span></span><span style=display:flex><span>vehicles_level8_it_0001.pkg           z_vehicles_events_0001.pkg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Let&rsquo;s use <code>file</code> to see what type of files we are dealing with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux Games/World of Warships » cd res_packages
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kakwa@linux World of Warships/res_packages » file *
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>spaces_dock_ny_0001.pkg:              data
</span></span><span style=display:flex><span>spaces_dock_ocean_0001.pkg:           data
</span></span><span style=display:flex><span>spaces_dock_prem_0001.pkg:            Microsoft DirectDraw Surface <span style=color:#f92672>(</span>DDS<span style=color:#f92672>)</span>: <span style=color:#ae81ff>4</span> x 4, compressed using DX10
</span></span><span style=display:flex><span>spaces_dock_rio_0001.pkg:             data
</span></span><span style=display:flex><span>spaces_dock_spb_0001.pkg:             data
</span></span><span style=display:flex><span>spaces_exterior_0001.pkg:             data
</span></span><span style=display:flex><span>spaces_faroe_0001.pkg:                OpenPGP Secret Key
</span></span><span style=display:flex><span>spaces_labyrinth_0001.pkg:            data
</span></span><span style=display:flex><span>spaces_lepve_0001.pkg:                data
</span></span><span style=display:flex><span>spaces_military_navigation_0001.pkg:  data
</span></span><span style=display:flex><span>spaces_naval_base_0001.pkg:           DOS executable <span style=color:#f92672>(</span>COM<span style=color:#f92672>)</span>, maybe with interrupt 22h, start instruction 0x8cbc075c 534dd337
</span></span><span style=display:flex><span>spaces_naval_defense_0001.pkg:        data
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>So mostly <code>data</code> (i.e., unknown binary format), and looking at the files which are not <code>data</code>, they are in fact most likely false positives. So we are dealing with a custom format.</p><h3 id=file-analysis>File Analysis</h3><p>Next, let&rsquo;s try to see if we have some clear-text strings in the files using the <code>strings</code> utility:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux World of Warships/res_packages » strings *
</span></span><span style=display:flex><span>YyHIKzR
</span></span><span style=display:flex><span>+!?&lt;
</span></span><span style=display:flex><span>m:C-
</span></span><span style=display:flex><span>h4.1
</span></span><span style=display:flex><span>~s3o
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>2bm
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>$ <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>O<span style=color:#f92672>=</span>z$
</span></span><span style=display:flex><span>&lt;27P
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>C<span style=color:#f92672>=</span>k<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>dQz<span style=color:#f92672>{</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>$Zm|
</span></span><span style=display:flex><span>$ZOc
</span></span><span style=display:flex><span>nV&amp;
</span></span><span style=display:flex><span>&lt;4n5
</span></span><span style=display:flex><span>r&gt;Zs%
</span></span><span style=display:flex><span>6?Iw
</span></span><span style=display:flex><span>KqM&amp;u
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Nada, that&rsquo;s just garbage. So we are dealing with a completely binary format.</p><p>Next, let&rsquo;s try to compress a file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Size before</span>
</span></span><span style=display:flex><span>kakwa@linux World of Warships/res_packages » ls -l vehicles_level4_usa_0001.pkg
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> kakwa kakwa <span style=color:#ae81ff>15356139</span> Jan <span style=color:#ae81ff>17</span> 19:01 vehicles_level4_usa_0001.pkg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Compress</span>
</span></span><span style=display:flex><span>kakwa@linux World of Warships/res_packages » gzip vehicles_level4_usa_0001.pkg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Size After</span>
</span></span><span style=display:flex><span>ls -l vehicles_level4_usa_0001.pkg.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> kakwa kakwa <span style=color:#ae81ff>15332196</span> Jan <span style=color:#ae81ff>17</span> 19:01 vehicles_level4_usa_0001.pkg.gz
</span></span></code></pre></div><p>Ok, barely any change in size, which means the data is probably compressed (not a big surprise since a lot of formats such as images are compressed).</p><p>Then, the process is a little fuzzy in my memory. But if I recall correctly, I did the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux World of Warships/res_packages » hexdump -C vehicles_level4_usa_0001.pkg | less
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000000</span>  <span style=color:#ae81ff>95</span> <span style=color:#ae81ff>58</span> 7f <span style=color:#ae81ff>50</span> 9b e7 7d 7f  f4 2a <span style=color:#ae81ff>24</span> e2 <span style=color:#ae81ff>55</span> <span style=color:#ae81ff>64</span> 7c bb  |.X.P..<span style=color:#f92672>}</span>..*$.Ud|.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000010</span>  a4 be 5b <span style=color:#ae81ff>77</span> 8d e6 <span style=color:#ae81ff>45</span> 0e  <span style=color:#ae81ff>08</span> <span style=color:#ae81ff>83</span> ba 5d b1 b7 b8 <span style=color:#ae81ff>35</span>  |..<span style=color:#f92672>[</span>w..E....<span style=color:#f92672>]</span>...5|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000020</span>  4a 2f e9 <span style=color:#ae81ff>71</span> d9 3f c4 e5  <span style=color:#ae81ff>45</span> 2a <span style=color:#ae81ff>05</span> a1 <span style=color:#ae81ff>92</span> eb 9d 2a  |J/.q.?..E*.....*|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000030</span>  <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>41</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>43</span> ab c3 <span style=color:#ae81ff>31</span> bc  c8 <span style=color:#ae81ff>97</span> 3b <span style=color:#ae81ff>41</span> c2 d0 f5 <span style=color:#ae81ff>82</span>  |wAsC..1...;A....|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00000040</span>  fd 2e <span style=color:#ae81ff>69</span> e3 <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>22</span> <span style=color:#ae81ff>84</span> <span style=color:#ae81ff>97</span>  <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>01</span> d1 b4 <span style=color:#ae81ff>04</span> <span style=color:#ae81ff>82</span> 8d <span style=color:#ae81ff>90</span>  |..i.w<span style=color:#e6db74>&#34;..W.......|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000050  f1 fe 68 bc 76 f3 ed ac  c0 75 ae 51 c9 b9 21 72  |..h.v....u.Q..!r|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000060  1d 58 36 05 59 46 7a f7  fd 3c 90 6d d7 6d 7f 4c  |.X6.YFz..&lt;.m.m.L|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00000070  77 f8 e3 e7 f7 f7 c7 e7  f9 7e bf cf fb e4 93 5f  |w........~....._|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[...]
</span></span></span></code></pre></div><p>I hexdumped one of the files, looking for some pattern that would help me determine the type of compression used. I was looking for things like padding or signatures repeating within the <code>.pkg</code> file. I&rsquo;m not sure how, but I finally determined the compression used was <code>DEFLATE</code> (RFC 1951) (I vaguely remember <code>7f f0</code> being a marker, but I might be mistaken).</p><p>In any case, <a href=https://en.wikipedia.org/wiki/List_of_file_signatures>The Wikipedia page listing file signatures</a> is really useful, as well as Googling around candidate patterns.</p><p>I ended up creating <a href=https://github.com/kakwa/brute-force-deflate>this tool</a> which tries to brute-force deflate all the sections of the file, and sure enough, I was able to extract some interesting files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Extracting stuff</span>
</span></span><span style=display:flex><span>kakwa@linux World of Warships/res_packages » bf-deflate -i system_data_0001.pkg -o systemout
</span></span><span style=display:flex><span><span style=color:#75715e># Look at the file types we just extracted</span>
</span></span><span style=display:flex><span>kakwa@linux World of Warships/res_packages » file systemout/* | tail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemout/000A15D8ED-000A15D8F3: ISO-8859 text, with no line terminators
</span></span><span style=display:flex><span>systemout/000A15D8F7-000A15EF9A: XML 1.0 document, ASCII text
</span></span><span style=display:flex><span>systemout/000A15EF9E-000A15EFA7: ISO-8859 text, with CR line terminators
</span></span><span style=display:flex><span>systemout/000A15EFAA-000A15F919: XML 1.0 document, ASCII text
</span></span><span style=display:flex><span>systemout/000A15F929-000A162634: exported SGML document, Unicode text, UTF-8 text, with CRLF line terminators
</span></span><span style=display:flex><span>systemout/000A162644-000A165D7C: ASCII text, with CRLF line terminators
</span></span><span style=display:flex><span>systemout/000A165D8C-000A16C774: ASCII text, with CRLF line terminators
</span></span><span style=display:flex><span>systemout/000A16C784-000A16D41A: exported SGML document, ASCII text, with CRLF line terminators
</span></span><span style=display:flex><span>systemout/000A16D41E-000A16D426: data
</span></span><span style=display:flex><span>systemout/bf-Xe4fzss:            empty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Look if we indeed got what &#34;file&#34; says it is</span>
</span></span><span style=display:flex><span>kakwa@linux World of Warships/res_packages » cat systemout/000A15EFAA-000A15F919
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;?xml version<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1.0&#34;</span> encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span> standalone<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no&#34;</span>?&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;root&gt;
</span></span><span style=display:flex><span>    &lt;Implements&gt;
</span></span><span style=display:flex><span>        &lt;Interface&gt;VisionOwner&lt;/Interface&gt;
</span></span><span style=display:flex><span>        &lt;Interface&gt;AtbaOwner&lt;/Interface&gt;
</span></span><span style=display:flex><span>        &lt;Interface&gt;AirDefenceOwner&lt;/Interface&gt;
</span></span><span style=display:flex><span>        &lt;Interface&gt;BattleLogicEntityOwner&lt;/Interface&gt;
</span></span><span style=display:flex><span>        &lt;Interface&gt;DamageDealerOwner&lt;/Interface&gt;
</span></span><span style=display:flex><span>        &lt;Interface&gt;DebugDrawEntity&lt;/Interface&gt;
</span></span><span style=display:flex><span>    &lt;/Implements&gt;
</span></span><span style=display:flex><span>&lt;/root&gt;
</span></span></code></pre></div><p>Okay, we actually are able to extract real files!</p><p>&mldr;But without the names, it&rsquo;s not that interesting.</p><p>Note that in my &ldquo;brute-force deflate&rdquo; tool, I chose to name the files I managed to extract with the (approximate) corresponding start and end offsets of what my tool managed to uncompress (ex: <code>000A165D8C-000A16C774</code>, start offset is <code>000A165D8C</code>, end is <code>000A16C774</code>). This makes it simpler to correlate each extracted file to a section in the original file.</p><p>Going back to the reverse engineering, that was progress, but I then lost interest and didn&rsquo;t follow up for two years.</p><h3 id=follow-up>Follow-up</h3><p>Two years later, I regained interest when I finally tested the Windows <code>wows_unpack</code> tool. It revealed that files have individual names and paths—indicating a custom archive format probably similar to a <code>.zip</code> file and most likely containing:</p><ul><li>Compressed data blobs</li><li>Index containing file paths, types, IDs, and offsets</li></ul><h3 id=pkg-file-format>PKG File Format</h3><p>Let&rsquo;s stare at more hexdumps:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux World of Warships/res_unpack » hexdump -C system_data_0001.pkg | less
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>000021e0  b7 df f2 d7 ff e4 4f bd  <span style=color:#ae81ff>52</span> f6 <span style=color:#ae81ff>39</span> be f5 4a <span style=color:#ae81ff>92</span> 2f  |......O.R.9..J./|
</span></span><span style=display:flex><span>000021f0  d9 8a f4 ff <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>00</span> bf <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>45</span> 5c 6c <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>00</span>  |...........E<span style=color:#ae81ff>\l</span>6.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002200</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> dd <span style=color:#ae81ff>97</span> cf  6e e2 <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>10</span> c6 cf <span style=color:#ae81ff>54</span> ea  |........n.0...T.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002210</span>  3b <span style=color:#ae81ff>44</span> <span style=color:#ae81ff>79</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>09</span> <span style=color:#ae81ff>09</span> <span style=color:#ae81ff>20</span>  <span style=color:#ae81ff>41</span> a5 <span style=color:#ae81ff>22</span> ca 9f <span style=color:#ae81ff>83</span> b7 <span style=color:#ae81ff>08</span>  |;Dy. .. A.<span style=color:#e6db74>&#34;.....|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002220  38 ec cd 72 93 61 6b 6d  6c 47 ce a4 85 b7 5f 3b  |8..r.akmlG...._;|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002230  25 0b 6d 29 d5 ae ba 12  9b 63 26 33 e3 df f7 79  |%.m).....c&amp;3...y|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>00002240  ec 28 03 26 b9 60 08 09  e1 79 9c 37 b7 22 bd b9  |.(.&amp;.`...y.7.&#34;</span>..|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>000023b0  <span style=color:#ae81ff>92</span> a0 6d bc <span style=color:#ae81ff>47</span> a6 f3 <span style=color:#ae81ff>58</span>  <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>37</span> f7 <span style=color:#ae81ff>16</span> d0 3b  |..m.G..X...7...;|
</span></span><span style=display:flex><span>000023c0  <span style=color:#ae81ff>06</span> 1c <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>44</span> f3 <span style=color:#ae81ff>55</span> fa 2f  dd af <span style=color:#ae81ff>44</span> bf fe 2f f9 <span style=color:#ae81ff>05</span>  |..1D.U./..D../..|
</span></span><span style=display:flex><span>000023d0  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 6d b9 de c1  ad 0c <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |....m...........|
</span></span><span style=display:flex><span>000023e0  7d cf cd 0d <span style=color:#ae81ff>80</span> <span style=color:#ae81ff>20</span> 0c <span style=color:#ae81ff>80</span>  d1 b3 <span style=color:#ae81ff>26</span> ce c2 <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>84</span> 8b  |<span style=color:#f92672>}</span>.... ....&amp;.....|
</span></span><span style=display:flex><span>000023f0  c6 <span style=color:#ae81ff>01</span> dc <span style=color:#ae81ff>00</span> b5 fe <span style=color:#ae81ff>24</span> <span style=color:#ae81ff>85</span>  <span style=color:#ae81ff>12</span> 5a f6 <span style=color:#ae81ff>57</span> 8c <span style=color:#ae81ff>92</span> <span style=color:#ae81ff>70</span> f1  |......$..Z.W..p.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002400</span>  f8 b5 ef d0 ea <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>24</span> a6  6b 1b 0d de ce <span style=color:#ae81ff>08</span> ab <span style=color:#ae81ff>19</span>  |.....H$.k.......|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002410</span>  2d <span style=color:#ae81ff>32</span> <span style=color:#ae81ff>68</span> f5 e5 b3 <span style=color:#ae81ff>42</span> <span style=color:#ae81ff>70</span>  e0 <span style=color:#ae81ff>85</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>94</span> <span style=color:#ae81ff>32</span> 5b 4c 2c  |-2h...Bp..s.2<span style=color:#f92672>[</span>L,|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002420</span>  c9 f5 <span style=color:#ae81ff>78</span> <span style=color:#ae81ff>86</span> 9b bf c3 4a  2c e4 <span style=color:#ae81ff>82</span> <span style=color:#ae81ff>65</span> fe <span style=color:#ae81ff>11</span> 7c 9c  |..x....J,..e..|.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002430</span>  <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>20</span> c4 1f b2 <span style=color:#ae81ff>27</span> 3f <span style=color:#ae81ff>91</span>  <span style=color:#ae81ff>58</span> a1 <span style=color:#ae81ff>98</span> <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>57</span> aa <span style=color:#ae81ff>44</span> 3e  |a ...<span style=color:#960050;background-color:#1e0010>&#39;</span>?.X...W.D&gt;|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002440</span>  4d ab e7 <span style=color:#ae81ff>97</span> 0b <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  <span style=color:#ae81ff>00</span> f1 d2 <span style=color:#ae81ff>87</span> 5a d2 <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>  |M...........Z...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002450</span>  <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> ad 9c db  6e db b8 <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>86</span> af <span style=color:#ae81ff>67</span> <span style=color:#ae81ff>03</span>  |........n.....g.|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002460</span>  fb 1d 3c b9 2f 3a 3e e4  <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>20</span> 0d c0 <span style=color:#ae81ff>48</span> 8c ad <span style=color:#ae81ff>89</span>  |..&lt;./:&gt;.P ..H...|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002470</span>  2c <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>28</span> c9 4e 7a <span style=color:#ae81ff>23</span> b8  <span style=color:#ae81ff>89</span> 3b <span style=color:#ae81ff>35</span> <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>89</span> <span style=color:#ae81ff>03</span> c7 <span style=color:#ae81ff>99</span>  |,i<span style=color:#f92672>(</span>.Nz#..;5&amp;....|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002480</span>  ee be fd <span style=color:#ae81ff>26</span> <span style=color:#ae81ff>75</span> <span style=color:#ae81ff>32</span> <span style=color:#ae81ff>29</span> 2e  <span style=color:#ae81ff>52</span> 4b <span style=color:#ae81ff>72</span> 2f 0a a4 <span style=color:#ae81ff>16</span> fd  |...&amp;u2<span style=color:#f92672>)</span>.RKr/....|
</span></span><span style=display:flex><span><span style=color:#ae81ff>00002490</span>  7f bf <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>72</span> <span style=color:#ae81ff>69</span> f1 e4 cb  d7 dd fa 6d bd bf fa ef  |..<span style=color:#f92672>(</span>ri......m....|
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>I noticed the 128 bits pattern <code>00 00 00 00 | xx xx xx xx | xx xx 00 00 | 00 00 00 00</code> repeating within the file (<code>|</code> used to cut every 32 bits).</p><p>The starts and ends of these small sections line up pretty well with the data sections I managed to extract:</p><pre tabindex=0><code>0000000001-00000021F6
0000002206-00000023D1
00000023E1-0000002446
0000002456-00000031C8
</code></pre><p>We indeed have the first <code>00 00 [...]</code> pattern starting at offset 000021f4 and ending 00002205, which nearly matches 00000021F6 (end of first extracted file) and 0000002206 (start of second extracted file).
The next pattern starts at 000023d0 and ends at 000023df, which again lines up roughly with 00000023D1 and 00000023E1. And so on for all the sections.</p><p>Note, my brute-force tool is most likely a bit buggy and probably adds a few +1 offsets here and there; also it is likely that the uncompression overflows a bit beyond the actual compressed data. But it is good enough for the purpose.</p><p>Looking at the end of the file, we have this pattern repeating one final time at the very end:</p><pre tabindex=0><code>0a16d3c0  79 b0 e2 a0 8e e3 a8 3c  4b d5 d4 51 a0 7b b2 a1  |y......&lt;K..Q.{..|
0a16d3d0  32 6b 36 bf fc ce 46 b6  1e d6 2d b8 94 98 ea 74  |2k6...F...-....t|
0a16d3e0  ac 57 92 19 a0 2f 7a c5  43 23 1e 46 0e 1d a8 6f  |.W.../z.C#.F...o|
0a16d3f0  9a fe f2 85 0e 6c 2f a4  8b 87 71 d4 5e 9a 8f d4  |.....l/...q.^...|
0a16d400  41 0f eb 85 aa b4 41 f7  ab af 86 39 6a d7 db af  |A.....A....9j...|
0a16d410  2a 24 8b 8f 8d 7f 6a f6  3f 00 00 00 00 6b ba c9  |*$....j.?....k..|
0a16d420  70 eb 6c 00 00 00 00 00  00                       |p.l......|
0a16d429
(END)
</code></pre><p>Furthermore, the first uncompressed block seems to start right at the beginning of the file, so there is probably no header section.</p><h3 id=pkg-structure>PKG Structure</h3><p>Looking at a few other <code>.pkg</code>, this pattern seems to be shared across all files.</p><p>So we can deduce the <code>.pkg</code> format is a concatenated list of sections like the following:</p><pre tabindex=0><code>+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
|                                                                                             |
|                             Compressed Data (RFC 1951/Deflate)                              |
|                                                                                             |
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
+====++====++====++====++====++====++====++====+====++====++====++====++====++====++====++====+
| 00 || 00 || 00 || 00 || XX || XX || XX || XX | XX || XX || 00 || 00 || 00 || 00 || 00 || 00 |
+====++====++====++====++====++====++====++====+====++====++====++====++====++====++====++====+
|&lt;----- 0 padding ----&gt;||&lt;----------- some kind of ID ---------------&gt;||&lt;---- 0 padding -----&gt;|
</code></pre><p>Note that by this point, I&rsquo;m making a lot of assumptions:</p><ul><li>I&rsquo;m assuming that <code>0 padding</code> 32-bit blocks are actually padding, but they could be fields that happened to be set to 0 most of the time</li><li>I&rsquo;m a bit puzzled by the 16-bit <code>00 00</code> at the end of <code>some kind of ID</code></li><li>I&rsquo;m also not completely sure if the block containing the data is always compressed using DEFLATE</li><li>I&rsquo;m not even sure if this general file format is actually shared across all files.</li></ul><p>But let&rsquo;s go forward, this format seems common enough to still yield good results. Plus we can always go back and revisit this interpretation.</p><h3 id=understanding-ids>Understanding IDs</h3><p>The 64-bit values between data blocks appear random and high-value—too short for hashes, too large for offsets. These are likely simple random unique identifiers:</p><pre tabindex=0><code>00 00 00 00 | bf 00 45 5c | 6c 36 00 00 | 00 00 00 00
00 00 00 00 | 6d b9 de c1 | ad 0c 00 00 | 00 00 00 00
00 00 00 00 | f1 d2 87 5a | d2 00 00 00 | 00 00 00 00
00 00 00 00 | 83 0a 72 88 | a3 5c 00 00 | 00 00 00 00
00 00 00 00 | 92 ab 31 63 | 91 2a 00 00 | 00 00 00 00
</code></pre><h3 id=recap>Recap</h3><p>We&rsquo;ve identified the data storage format:</p><ul><li>Game data resides in <code>res_packages/</code> directory</li><li><code>.pkg</code> files are custom archives containing (mostly) DEFLATE-compressed blobs separated by 64-bit IDs</li><li>File names and paths are probably stored separately</li></ul><p>Getting the file metadata will be explored in <a href=/posts/wows_depack_part2/>the next part</a> of this series.</p><hr><div class=related></div></div></div></section><script src=/js/copycode.js></script><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/kakwa>Pierre-Francois Carpentier</a> 2024</p></div></section></body></html>