<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en><head><script defer language=javascript type=text/javascript src=/js/bundle.min.8f93f92296a878c32e6b4c2b8a5412b8a32e43651fef6cfc0c506fd40a5db718.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=favicon-32x32.png><title itemprop=name>Kakwa's Blog - Reversing WoWs Resource Format - Part 3: Dissecting The Index</title>
<meta property="og:title" content="Kakwa's Blog - Reversing WoWs Resource Format - Part 3: Dissecting The Index"><meta name=twitter:title content="Kakwa's Blog - Reversing WoWs Resource Format - Part 3: Dissecting The Index"><meta itemprop=name content="Kakwa's Blog - Reversing WoWs Resource Format - Part 3: Dissecting The Index"><meta name=application-name content="Kakwa's Blog - Reversing WoWs Resource Format - Part 3: Dissecting The Index"><meta property="og:site_name" content="Technically some technical stuff."><meta name=description content="Just another geek who likes to build stuff and write about it"><meta itemprop=description content="Just another geek who likes to build stuff and write about it"><meta property="og:description" content="Just another geek who likes to build stuff and write about it"><meta name=twitter:description content="Just another geek who likes to build stuff and write about it"><base href=https://technically.kakwalab.ovh/posts/wows_depack_part3/><link rel=canonical href=https://technically.kakwalab.ovh/posts/wows_depack_part3/ itemprop=url><meta name=url content="https://technically.kakwalab.ovh/posts/wows_depack_part3/"><meta name=twitter:url content="https://technically.kakwalab.ovh/posts/wows_depack_part3/"><meta property="og:url" content="https://technically.kakwalab.ovh/posts/wows_depack_part3/"><meta property="og:updated_time" content="2025-08-25T12:02:00+02:00"><link rel=sitemap type=application/xml title=Sitemap href=https://technically.kakwalab.ovh/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content="Technically some technical stuff."><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=generator content="Hugo 0.128.0"><link type=text/css rel=stylesheet href=/css/bundle.min.6d6c2943e379c42782f5a80f6f595aa21063bff1a14d2e36c38ecbac9910e2ae.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#EDE7DB;--sidebar-a-color:#EDE7DB;--sidebar-socials-color:#EDE7DB;--text-color:#303030;--bkg-color:#F5F2E8;--post-title-color:#303030;--list-color:#5A5A5A;--link-color:#268BD2;--date-color:#515151;--table-border-color:#E3E0D8;--table-stripe-color:#F0ECE3;--code-color:#303030;--code-background-color:#E0E0E0;--code-block-color:#F5F2E8;--code-block-background-color:#272822;--moon-sun-color:#EDE7DB;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#EDE7DB;--bkg-color:#1A1A1A;--post-title-color:#EDE7DB;--list-color:#9D9D9D;--link-color:#268BD2;--date-color:#9A9A9A;--table-border-color:#515151;--table-stripe-color:#1E1E1E;--code-color:#EDE7DB;--code-background-color:#515151;--code-block-color:#EDE7DB;--code-block-background-color:#272822}body{background-color:var(--bkg-color)}</style></head><body class=dark-theme><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://technically.kakwalab.ovh/><img src=/author.png alt="brand image">
</a><a href=https://technically.kakwalab.ovh/><h1>Kakwa's Blog</h1></a></h1><p class=lead>Just another geek who likes to build stuff and write about it</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Blog Posts</a></li><li class=heading>External Links</li><li class=bullet><a href="https://github.com/kakwa?tab=repositories&amp;q=&amp;type=&amp;language=&amp;sort=stargazers" target=_blank rel="noopener noreferrer">Software Projects</a></li><li class=bullet><a href=https://www.printables.com/@kakwa_3337391/models target=_blank rel="noopener noreferrer">3D Printing Models</a></li><li class=bullet><a href=https://lens.kakwalab.ovh/ target=_blank rel="noopener noreferrer">Photos</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/kakwa><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg>
</a><a target=_blank class=social title=LinkedIn href=https://www.linkedin.com/in/pfcarpentier><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</a><a target=_blank class=social rel=me title=Mastodon href=https://mastodon.social/@kakwa_><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill="currentcolor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18V8.91z"/></svg>
</a><a target=_blank class=social title="RSS Feed" href=/posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg>
</a><a target=_blank class=social title=Email href=mailto:carpentier.pf@gmail.com><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211"><path fill="currentcolor" d="M301.393 241.631 464.866 424.56H20.332l163.474-182.928 58.801 51.443 58.786-51.444zM462.174 60.651H23.027l219.579 192.142L462.174 60.651zM324.225 221.67l160.986 180.151V80.792L324.225 221.67zM0 80.792v321.029L160.972 221.64.0 80.792z"/></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2025 Pierre-François Carpentier. All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://technically.kakwalab.ovh/posts/wows_depack_part3/>Reversing WoWs Resource Format - Part 3: Dissecting The Index</a></h1><div class=headline><div><time datetime=2025-08-25T12:02:00+0200 class=post-date>August 25, 2025
</time><span>- </span><span class=reading-time><span>37 mins read</span></span></div></div></div><ul><li>Part 1 — <a href=/posts/wows_depack_part1/>Searching The Data</a></li><li>Part 2 — <a href=/posts/wows_depack_part2/>Looking For The Metadata</a></li><li>Part 3 — <a href=/posts/wows_depack_part3/>Dissecting The Index</a></li><li>Part 4 — <a href=/posts/wows_depack_part4/>Reading Everything</a></li><li>Part 5 — <a href=/posts/wows_depack_part5/>Tidying-Up The Project</a></li></ul><h1 id=index-file-reverse-engineering>Index File Reverse Engineering</h1><p>In the last part, we found the location of the index and determine the general layout.</p><p>Now, let&rsquo;s do the detailed reverse engineering.</p><h2 id=metadata-chunk-format>Metadata Chunk Format</h2><p>The first section contains file metadata entries:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx | less
</span></span></code></pre></div><pre tabindex=0><code>00000000  49 53 46 50 00 00 00 02  91 9d 39 b4 40 00 00 00  |ISFP......9.@...|
00000010  37 01 00 00 1c 01 00 00  01 00 00 00 00 00 00 00  |7...............|
00000020  28 00 00 00 00 00 00 00  f6 3b 00 00 00 00 00 00  |(........;......|
00000030  36 71 00 00 00 00 00 00  0e 00 00 00 00 00 00 00  |6q..............|
00000040  e0 26 00 00 00 00 00 00  8f 0c 9a ba 4f 40 b6 93  |.&amp;..........O@..|
00000050  27 b9 08 b1 d1 a1 b1 db  13 00 00 00 00 00 00 00  |&#39;...............|
00000060  ce 26 00 00 00 00 00 00  8f ec 87 4a 28 d0 f7 c7  |.&amp;.........J(...|
00000070  a4 eb 1b 3e 50 21 d8 74  12 00 00 00 00 00 00 00  |...&gt;P!.t........|
00000080  c1 26 00 00 00 00 00 00  ad 70 a2 e7 ac 2c 4f 6b  |.&amp;.......p...,Ok|
00000090  27 b9 08 b1 d1 a1 b1 db  0e 00 00 00 00 00 00 00  |&#39;...............|
000000a0  b3 26 00 00 00 00 00 00  4e 84 a5 6a 94 dc 1f 7f  |.&amp;......N..j....|
000000b0  62 f5 aa 4b 5e 15 7f 93  10 00 00 00 00 00 00 00  |b..K^...........|
000000c0  a1 26 00 00 00 00 00 00  4e b0 fe 23 62 40 a5 65  |.&amp;......N..#b@.e|
000000d0  27 b9 08 b1 d1 a1 b1 db  20 00 00 00 00 00 00 00  |&#39;....... .......|
000000e0  91 26 00 00 00 00 00 00  8e c7 6a 58 7c 86 62 33  |.&amp;........jX|.b3|
000000f0  27 b9 08 b1 d1 a1 b1 db  0f 00 00 00 00 00 00 00  |&#39;...............|
00000100  91 26 00 00 00 00 00 00  8e 43 3d e9 cf 49 52 a4  |.&amp;.......C=..IR.|
00000110  62 f5 aa 4b 5e 15 7f 93  16 00 00 00 00 00 00 00  |b..K^...........|
00000120  80 26 00 00 00 00 00 00  0e 3c 9a 6d 22 de 7b da  |.&amp;.......&lt;.m&#34;.{.|
00000130  4e b0 fe 23 62 40 a5 65  0b 00 00 00 00 00 00 00  |N..#b@.e........|
00000140  76 26 00 00 00 00 00 00  0e 48 58 ea 50 44 1a 47  |v&amp;.......HX.PD.G|
00000150  df 61 50 67 c7 3a dd 7a  13 00 00 00 00 00 00 00  |.aPg.:.z........|
00000160  61 26 00 00 00 00 00 00  e0 9f c3 bd d2 12 20 04  |a&amp;............ .|
00000170  09 28 f1 df 2d 04 93 de  0b 00 00 00 00 00 00 00  |.(..-...........|

00002690  a4 eb 1b 3e 50 21 d8 74  0c 00 00 00 00 00 00 00  |...&gt;P!.t........|
000026a0  21 15 00 00 00 00 00 00  00 40 cc c7 49 c4 54 09  |!........@..I.T.|
000026b0  a4 eb 1b 3e 50 21 d8 74  14 00 00 00 00 00 00 00  |...&gt;P!.t........|
000026c0  0d 15 00 00 00 00 00 00  ce 6a 28 bc cf e7 79 c8  |.........j(...y.|
000026d0  a4 eb 1b 3e 50 21 d8 74  1a 00 00 00 00 00 00 00  |...&gt;P!.t........|
000026e0  01 15 00 00 00 00 00 00  6c c0 c9 f7 7e 00 03 05  |........l...~...|
000026f0  a4 eb 1b 3e 50 21 d8 74  13 00 00 00 00 00 00 00  |...&gt;P!.t........|
00002700  fb 14 00 00 00 00 00 00  74 d1 1b 8d f4 ff 7a ce  |........t.....z.|
00002710  a4 eb 1b 3e 50 21 d8 74  4b 44 53 74 6f 72 61 67  |...&gt;P!.tKDStorag|
00002720  65 2e 62 69 6e 00 77 61  76 65 73 5f 68 65 69 67  |e.bin.waves_heig|
00002730  68 74 73 31 2e 64 64 73  00 61 6e 69 6d 61 74 65  |hts1.dds.animate|
00002740  64 4d 69 73 63 73 2e 78  6d 6c 00 4c 6f 77 65 72  |dMiscs.xml.Lower|
00002750  44 65 63 6b 2e 64 64 73  00 63 6f 6d 6d 61 6e 64  |Deck.dds.command|
</code></pre><p>Staring at the hexdump long enough and we can start to see some patterns.</p><p>At regular intervals, every 256 bits, we get a 64-bit integer with a relatively low value, hinting at individual metadata sets of 256 bits.</p><p>This looks suspiciously like some kind of constant enum coded into a 64-bit integer.
My best guess right now would be some kind of file type code, itself defined as a constant in the game engine like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#75715e>#define FILE_TYPE_1 0x01
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define FILE_TYPE_2 0x02
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>// [...]
</span></span></span></code></pre></div><p>Let&rsquo;s call it <code>file_type</code> for now.</p><p>Looking at the end of the first chunk (right before we get <code>KDStorage.bin</code>), we have to go back 4 x 64 bits to get something that looks like a <code>file_type</code>.</p><p>This means <code>file_type</code> is the first field in the 256-bit structure.</p><p>Let&rsquo;s look at the next 64 bits: <code>ce 26 00 00 00 00 00 00</code>, <code>c1 26 00 00 00 00 00 00</code>, <code>80 26 00 00 00 00 00 00</code>, etc. These values are again rather small.</p><p>Also these values, at least for the first ones, are suspiciously close to <code>00002718</code>, i.e. right where the section containing the file names starts.</p><p>The last ones, <code>01 15 00 00 00 00 00 00</code>, <code>fb 14 00 00 00 00 00 00</code>, etc., are smaller, and suspiciously, they have similar values to the length of the file name section (approximately <code>0x00003c00 - 0x00002710 = 0x0000014f0</code>).</p><p>The second field is then probably some kind of offset. Most likely from the start of one 256-bit chunk to the start of one of the file names.</p><p>Looking at other <code>.idx</code> files seems to confirm that.</p><p>Let&rsquo;s call it <code>offset</code> for now.</p><p>Next, let&rsquo;s look at the remaining 128 bits.</p><pre tabindex=0><code>8f 0c 9a ba 4f 40 b6 93 | 27 b9 08 b1 d1 a1 b1 db
8f ec 87 4a 28 d0 f7 c7 | a4 eb 1b 3e 50 21 d8 74
ad 70 a2 e7 ac 2c 4f 6b | 27 b9 08 b1 d1 a1 b1 db
4e 84 a5 6a 94 dc 1f 7f | 62 f5 aa 4b 5e 15 7f 93
4e b0 fe 23 62 40 a5 65 | 27 b9 08 b1 d1 a1 b1 db
8e c7 6a 58 7c 86 62 33 | 27 b9 08 b1 d1 a1 b1 db
</code></pre><p>First thing to note: all the bits are used, which disqualifies offsets or simple enum IDs like before.</p><p>Right now, we are not even sure these 128 bits are part of one 128-bit field (for example a hash), two 64-bit integers, four 32-bit integers, or any combination of 16, 32 or 64 bits that ends up making a 128-bit chunk.</p><p>Looking at it more closely, the first 64 bits looks rather random, the last 64 bits however? we see quite a few values repeating themselves (ex: <code>27 b9 08 b1 d1 a1 b1 db</code>).</p><p>Let&rsquo;s check the whole file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx | grep <span style=color:#e6db74>&#39;00 00 00 00 00 00 00&#39;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    sed <span style=color:#e6db74>&#39;s/^..........//&#39;</span> | sed <span style=color:#e6db74>&#39;s/  .*//&#39;</span> | sort  | uniq -c | sort -n
</span></span></code></pre></div><pre tabindex=0><code># note: first number is the number of occurrences
      1 00 00 00 00 00 00 00 af
      1 1c 6a 8d 7f df 8e b3 35
      1 28 00 00 00 00 00 00 00
      1 36 71 00 00 00 00 00 00
      1 37 01 00 00 1c 01 00 00
      1 7d e3 1c a4 35 3e 98 8b
      1 e0 95 53 f6 cc 08 c0 46
      2 12 46 58 36 c8 ec 47 8b
      2 4e b0 fe 23 62 40 a5 65
      2 d0 d7 a5 ce a8 86 0e ae
      3 1a aa c7 3c 4e 76 ad 94
      3 4c d1 2e 30 73 38 d9 13
      3 4c f0 ea c1 d5 5a 8d 12
      3 88 57 fc 1c 72 f3 84 fa
      3 ac 82 d5 f6 9e db 47 f9
      3 b1 86 45 dc 7a 63 37 38
      3 fc 27 83 2d 44 46 30 a3
      6 76 83 17 b5 cf dd b7 0e
      8 06 cf 85 bd 69 99 e2 46
      9 09 28 f1 df 2d 04 93 de
     10 a4 eb 1b 3e 50 21 d8 74
     10 d7 22 2f fc 0a 67 7a 0d
     14 aa db f0 18 01 89 b6 d8
     15 df 61 50 67 c7 3a dd 7a
     18 19 ac 65 3f 91 78 97 dc
     19 38 e6 83 3c 74 a7 20 b2
     19 59 dc e0 43 fc 88 b7 7c
     23 d3 9e 86 23 25 42 27 45
     24 0e 48 58 ea 50 44 1a 47
     33 d7 19 f3 03 3e 6e 59 03
     34 27 b9 08 b1 d1 a1 b1 db
     38 62 f5 aa 4b 5e 15 7f 93
</code></pre><p>Indeed, the repetitions are quite frequent, and running the same command on other files yields roughly the same values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C particles.idx | grep <span style=color:#e6db74>&#39;00 00 00 00 00 00 00&#39;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    sed <span style=color:#e6db74>&#39;s/^..........//&#39;</span> | sed <span style=color:#e6db74>&#39;s/  .*//&#39;</span> | sort  | uniq -c | sort -n
</span></span></code></pre></div><pre tabindex=0><code>      1 27 b9 08 b1 d1 a1 b1 db
      1 28 00 00 00 00 00 00 00
      1 8e ae 00 00 00 00 00 00
      1 bd 01 00 00 b7 01 00 00
      4 ca 2c b7 97 24 b8 1c 86
      5 1f 19 a6 0c a2 9b 7f b3
     16 94 a1 23 f4 c5 41 b8 42
     20 91 cc 55 52 25 2a 42 d4
     81 de 3e 45 0e 99 dc 30 14
    317 66 52 00 d6 89 64 1d 2e
</code></pre><p>Moreover, <code>sound_music.idx</code>, which as the name implies probably only contains sound files, returns mostly one type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C sound_music.idx | grep <span style=color:#e6db74>&#39;00 00 00 00 00 00 00&#39;</span> | <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    sed <span style=color:#e6db74>&#39;s/^..........//&#39;</span> | sed <span style=color:#e6db74>&#39;s/  .*//&#39;</span> | sort  | uniq -c | sort -n
</span></span></code></pre></div><pre tabindex=0><code>    513 93 63 67 56 c2 97 75 69
</code></pre><p>Note: these commands are by no means accurate; they are likely to catch garbage and miscount. But these are quick and dirty ways to validate hypotheses.</p><p>So it seems we are dealing with another <code>file_type</code> field. Let&rsquo;s call it <code>file_type2</code>, and rename the first one <code>file_type1</code>.</p><p>So in the end, making a few assumptions for now, we have figured out the rough format of this section:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| T1 | T1 | T1 | T1 | T1 | T1 | T1 | T1 || OF | OF | OF | OF | OF | OF | OF | OF |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;---------- file type 1 --------------&gt;||&lt;------------ offset -----------------&gt;|
|               64 bits                 ||               64 bits                 |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| UN | UN | UN | UN | UN | UN | UN | UN || T2 | T2 | T2 | T2 | T2 | T2 | T2 | T2 |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;------------ unknown ----------------&gt;||&lt;---------- file type 2 --------------&gt;|
|               64 bits                 ||               64 bits                 |
</code></pre><h2 id=header-section-analysis>Header Section Analysis</h2><p>The <code>.idx</code> file header contains:</p><pre tabindex=0><code>00000000  49 53 46 50 00 00 00 02  91 9d 39 b4 40 00 00 00  |ISFP......9.@...|
00000010  37 01 00 00 1c 01 00 00  01 00 00 00 00 00 00 00  |7...............|
00000020  28 00 00 00 00 00 00 00  f6 3b 00 00 00 00 00 00  |(........;......|
00000030  36 71 00 00 00 00 00 00  0e 00 00 00 00 00 00 00  |6q..............|
00000040  e0 26 00 00 00 00 00 00  8f 0c 9a ba 4f 40 b6 93  |.&amp;..........O@..|
00000050  27 b9 08 b1 d1 a1 b1 db  13 00 00 00 00 00 00 00  |&#39;...............|
00000060  ce 26 00 00 00 00 00 00  8f ec 87 4a 28 d0 f7 c7  |.&amp;.........J(...|
00000070  a4 eb 1b 3e 50 21 d8 74  12 00 00 00 00 00 00 00  |...&gt;P!.t........|
00000080  c1 26 00 00 00 00 00 00  ad 70 a2 e7 ac 2c 4f 6b  |.&amp;.......p...,Ok|
00000090  27 b9 08 b1 d1 a1 b1 db  0e 00 00 00 00 00 00 00  |&#39;...............|
</code></pre><p>These first bytes don&rsquo;t look like the <code>section</code> previously mentioned; we have a magic number (<code>ISFP</code>), and then the content doesn&rsquo;t look like a <code>section</code> at first (too many low-value 32-bit integers).</p><p>This means we most likely have a header section containing things like:</p><ul><li>magic numbers</li><li>types</li><li>sizes</li><li>number of entries/files</li></ul><p>The first thing to determine is the size of the header. Looking at it, the first <code>section</code> starts at <code>0x38</code> (recognisable by the full 64-bit integers).</p><p>This means the header is 7 × 64 bits.</p><p>Let&rsquo;s analyze the content.</p><p>Looking at all the files, for the first 128 bits, we get:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n 1;<span style=color:#66d9ef>done</span>
</span></span></code></pre></div><pre tabindex=0><code>[...]
00000000  49 53 46 50 00 00 00 02  1b 73 f9 d5 40 00 00 00  |ISFP.....s..@...|
00000000  49 53 46 50 00 00 00 02  78 f0 2c 09 40 00 00 00  |ISFP....x.,.@...|
00000000  49 53 46 50 00 00 00 02  b8 fe ba b9 40 00 00 00  |ISFP........@...|
00000000  49 53 46 50 00 00 00 02  06 24 fa 2d 40 00 00 00  |ISFP.....$.-@...|
00000000  49 53 46 50 00 00 00 02  1e 7e f6 d9 40 00 00 00  |ISFP.....~..@...|
00000000  49 53 46 50 00 00 00 02  dd 21 74 c2 40 00 00 00  |ISFP.....!t.@...|
00000000  49 53 46 50 00 00 00 02  33 28 63 bd 40 00 00 00  |ISFP....3(c.@...|
00000000  49 53 46 50 00 00 00 02  cb 5c e2 0d 40 00 00 00  |ISFP.....\..@...|
00000000  49 53 46 50 00 00 00 02  cb e8 8a fd 40 00 00 00  |ISFP........@...|
00000000  49 53 46 50 00 00 00 02  6e 04 b1 62 40 00 00 00  |ISFP....n..b@...|
00000000  49 53 46 50 00 00 00 02  15 1c a2 f9 40 00 00 00  |ISFP........@...|
[...]
</code></pre><p>As we can see, the 1st, 2nd, and 4th 32-bit chunks are always the same, and looking at the values, we have respectively:</p><ul><li>a magic number (<code>ISFP</code>),</li><li><code>00 00 00 02</code> which is rather weird (it could be some kind of ID if we were little-endian, but the format is big-endian). Maybe it is actually part of the magic number. As it doesn&rsquo;t vary, it&rsquo;s not too important for the task at hand here.</li><li><code>40 00 00 00</code> which, like <code>type 1</code>, looks like a low-value enum, and given its position in the index file, within the header, we are most likely dealing with an archive type. Again, as it doesn&rsquo;t vary, it&rsquo;s not really important.</li></ul><p>The 3rd 32-bit integer uses all the available bits, so it&rsquo;s unlikely a size. Maybe it&rsquo;s a CRC32 or a unique ID for the archives.</p><p>Edit: the <code>40 00 00 00</code> value upon closer inspection might not be an archive type; its value is 64 in decimal, which might be a header size, or simply storing the size of an integer.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| MA | MA | MA | MA || 00 | 00 | 00 | 02 || ID | ID | ID | ID || 40 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;----- magic -----&gt;||&lt;----- ???? ------&gt;||&lt;---- id/crc -----&gt;||&lt;----- ??????? ---&gt;|
</code></pre><p>Now, let&rsquo;s look at the next 128 bits (second line in the hexdump).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n <span style=color:#ae81ff>2</span> | tail -n 1;<span style=color:#66d9ef>done</span>
</span></span></code></pre></div><pre tabindex=0><code>00000010  bd 01 00 00 b7 01 00 00  01 00 00 00 00 00 00 00  |................|
00000010  35 01 00 00 1d 01 00 00  01 00 00 00 00 00 00 00  |5...............|
00000010  5b 00 00 00 57 00 00 00  01 00 00 00 00 00 00 00  |[...W...........|
00000010  5c 00 00 00 58 00 00 00  01 00 00 00 00 00 00 00  |\...X...........|
00000010  10 18 00 00 ff 17 00 00  01 00 00 00 00 00 00 00  |................|
00000010  29 3b 00 00 0b 3b 00 00  01 00 00 00 00 00 00 00  |);...;..........|
00000010  04 02 00 00 02 02 00 00  01 00 00 00 00 00 00 00  |................|
00000010  1e 05 00 00 c2 03 00 00  01 00 00 00 00 00 00 00  |................|
00000010  a5 01 00 00 36 01 00 00  01 00 00 00 00 00 00 00  |....6...........|
00000010  13 04 00 00 fb 02 00 00  01 00 00 00 00 00 00 00  |................|
00000010  79 03 00 00 a9 02 00 00  01 00 00 00 00 00 00 00  |y...............|
</code></pre><p>So here, we recognize two 32-bit integers due to the <code>00 00</code>, and then either a fixed 64-bit integer with always a <code>01 00 00 00 00 00 00 00</code> value, or something like two 32-bit integers with value <code>01 00 00 00</code> and <code>00 00 00 00</code> (as the value never varies, again, it&rsquo;s not that important).</p><p>Let&rsquo;s try to determine the two 32-bit values. Let&rsquo;s look at one of the files in particular:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx | less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00000010  37 01 00 00 1c 01 00 00  01 00 00 00 00 00 00 00  |7...............|
[...]
</code></pre><p>The first value is <code>37 01 00 00</code>, i.e. converted to decimal, <code>311</code>. Doing a <code>strings system_data.idx > listing</code> and removing the garbage (ex: <code>w6~n</code>) as best as possible, plus the <code>.pkg</code> file name, only keeping files and directory names, we get <code>310</code> entries, a remarkably close value.</p><p>Looking at other files, story is similar, this field roughly matches the number of strings we get from <code>strings</code> (never perfectly however, but if the names are too short, <code>strings</code> will ignore them, most likely explaining the small delta we have each time).</p><p>Consequently we can deduce it&rsquo;s most likely the number of entries (files and directories) in the index file.</p><p>Next, we have <code>1c 01 00 00</code>, i.e. converted to decimal, <code>284</code>. This value is suspiciously close to the previous value. As we have both directories and file names, this number probably represents the number of items that are actual files.</p><p>Let&rsquo;s validate that:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Q&amp;D filtering out names without an extension (no &#39;.&#39;)</span>
</span></span><span style=display:flex><span>kakwa@linux 6775398/idx » cat listing | grep  <span style=color:#e6db74>&#39;\.&#39;</span> | wc -l
</span></span></code></pre></div><pre tabindex=0><code>284
</code></pre><p>Bingo, we have the exact number we were looking for.</p><p>The last 64 bits could simply be ignored for now since they always have the same value.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| FD | FD | FD | FD || FI | FI | FI | FI || 01 | 00 | 00 | 00 || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;file + dir count &gt;||&lt;-- file count ---&gt;||&lt;-------------- ???? ------------------&gt;|
</code></pre><p>Next 128 bits:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n <span style=color:#ae81ff>3</span> | tail -n 1;<span style=color:#66d9ef>done</span> | less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00000020  28 00 00 00 00 00 00 00  58 8d 00 00 00 00 00 00  |(.......X.......|
00000020  28 00 00 00 00 00 00 00  7c 3f 02 00 00 00 00 00  |(.......|?......|
00000020  28 00 00 00 00 00 00 00  77 2f 00 00 00 00 00 00  |(.......w/......|
00000020  28 00 00 00 00 00 00 00  bc e9 01 00 00 00 00 00  |(...............|
00000020  28 00 00 00 00 00 00 00  c6 ea 02 00 00 00 00 00  |(...............|
00000020  28 00 00 00 00 00 00 00  a9 0f 00 00 00 00 00 00  |(...............|
00000020  28 00 00 00 00 00 00 00  c4 22 00 00 00 00 00 00  |(........&#34;......|
00000020  28 00 00 00 00 00 00 00  b6 2b 00 00 00 00 00 00  |(........+......|
00000020  28 00 00 00 00 00 00 00  d6 41 00 00 00 00 00 00  |(........A......|
00000020  28 00 00 00 00 00 00 00  fd 21 00 00 00 00 00 00  |(........!......|
00000020  28 00 00 00 00 00 00 00  e1 25 00 00 00 00 00 00  |(........%......|
00000020  28 00 00 00 00 00 00 00  f5 31 00 00 00 00 00 00  |(........1......|
00000020  28 00 00 00 00 00 00 00  1e 42 00 00 00 00 00 00  |(........B......|
00000020  28 00 00 00 00 00 00 00  70 42 02 00 00 00 00 00  |(.......pB......|
[...]
</code></pre><p>So here, we have two 64-bit integers. The first one is <code>28 00 00 00 00 00 00 00</code> and always has the same value. Not sure what it represents; the value is somewhat close to the header size in bytes: 40 for this value, 56 for the full header size.</p><p>Maybe the header could vary in size in certain situations, and this represents its size minus some fixed part (like the first 16 bytes/128 bits). I&rsquo;m also kind of betting that if the previous 64-bit integer (<code>01 00 00 00 00 00 00 00</code>) changes, this will also change.</p><p>But as it never varies in the set of index files we have here, we cannot really make any deduction, only guesses. So once again, let&rsquo;s ignore it.</p><p>At this point, the idea of downloading other Wargaming games like World of Tanks or World of Warplanes popped up; maybe this will give complementary information regarding the unknown fields that start to pile up.</p><p>But let&rsquo;s continue for now.</p><p>EDIT: It&rsquo;s no help; World of Tanks and World of Warplanes simply pack their resources in <code>.zip</code> files&mldr;
It&rsquo;s a wild guess, but I kind of expect WoWs to be the same in the future.
The WoWs packing format feels, in fact, somewhat legacy, custom, and far less efficient than a standard run-of-the-mill <code>.zip</code> file. Not to mention using <code>.zip</code> files means removing one bit of code to maintain.</p><p>The next value is again a 64-bit integer; it changes between each file.</p><p>Let&rsquo;s focus on one file:</p><pre tabindex=0><code>[...]
00000020  28 00 00 00 00 00 00 00  f6 3b 00 00 00 00 00 00  |(........;......|
[...]
</code></pre><p>At first, I thought it might be a file size, but quickly checking the index file size, I got:</p><ul><li>index file size: 29043</li><li>value of this field in decimal: 15350</li></ul><p>Checking another file, I got 77461 and 44807.</p><p>So no, it&rsquo;s not the index size. However it is suspiciously ~1/2 of the file size, and after having stared at hexdumps for hours, I had another idea.</p><p>The third chunk of the file is right after the bundle of dir/file name strings which varies in length wildly (i.e., it&rsquo;s not a fixed length or a multiple of a fixed length).</p><p>We probably need an offset pointing to the start of this section in the header.</p><p>And sure enough, looking where the bundle of strings stops, we get:</p><pre tabindex=0><code>00003bd0  6f 69 73 65 2e 64 64 73  00 73 70 61 63 65 5f 76  |oise.dds.space_v|
00003be0  61 72 69 61 74 69 6f 6e  5f 64 75 6d 6d 79 2e 64  |ariation_dummy.d|
00003bf0  64 73 00 77 61 76 65 73  5f 68 65 69 67 68 74 73  |ds.waves_heights|
00003c00  30 2e 64 64 73 00 8f ec  87 4a 28 d0 f7 c7 70 11  |0.dds....J(...p.|
00003c10  03 07 0d 33 ed 77 1e 9b  ef 05 00 00 00 00 05 00  |...3.w..........|
</code></pre><p>Okay, the string bundle ends at 00003c05; that&rsquo;s quite near 3bf6, so this is certainly the offset to this third section or the end of the bundle of strings.</p><p>Most likely, the offset is not from the start of the file but from a specific point in the header (this field? end of header?); that&rsquo;s why we get a -15 difference (0x00003c05 - 0x3bf6 = 0xF = 15). This -15 value is constant between files.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| HS | HS | HS | HS | HS | HS | HS | HS || OF | OF | OF | OF | OF | OF | OF | OF |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;------------ header size (?) --------&gt;||&lt;---- offset third section start -----&gt;|
</code></pre><p>Last 64 bits:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6623042/idx » <span style=color:#66d9ef>for</span> i in *;<span style=color:#66d9ef>do</span> hexdump -C $i | head -n <span style=color:#ae81ff>4</span> | tail -n 1;<span style=color:#66d9ef>done</span> | less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00000030  40 af 03 00 00 00 00 00  1b 00 00 00 00 00 00 00  |@...............|
00000030  54 8d 1f 00 00 00 00 00  21 00 00 00 00 00 00 00  |T.......!.......|
00000030  8e ae 00 00 00 00 00 00  17 00 00 00 00 00 00 00  |................|
00000030  02 81 00 00 00 00 00 00  13 00 00 00 00 00 00 00  |................|
00000030  c9 24 00 00 00 00 00 00  1f 00 00 00 00 00 00 00  |.$..............|
[...]
</code></pre><p>So, we have a 64-bit integer, which is a relatively low value. This means it&rsquo;s most likely a size or an offset.</p><p>If we pick one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6623042/idx » hexdump -C system_data.idx | less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00000030  36 71 00 00 00 00 00 00  13 00 00 00 00 00 00 00  |6q..............|
[...]
</code></pre><p>We can see that the <code>36 71 00 00 00 00 00 00</code>, 28982 once converted to decimal, is remarkably close to the file size (29043 bytes).</p><p>From there, we can guess it might be three things:</p><ul><li>the actual index file size</li><li>an offset to something at the end of the file</li><li>pointer to the end of the third section</li></ul><p>Let&rsquo;s note that for now, and figure out the finer details at implementation time.</p><p>So, to recap, here is the header section format:</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| MA | MA | MA | MA || 00 | 00 | 00 | 02 || ID | ID | ID | ID || 40 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;----- magic -----&gt;||&lt;----- ???? ------&gt;||&lt;---- id/crc -----&gt;||&lt;----- ??????? ---&gt;|

+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
| FD | FD | FD | FD || FI | FI | FI | FI || 01 | 00 | 00 | 00 || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;file + dir count &gt;||&lt;-- file count ---&gt;||&lt;-------------- ???? ------------------&gt;|

+====+====+====+====+====+====+====+=====++=====+====+====+====+====+====+====+====+
| HS | HS | HS | HS | HS | HS | HS | HS  ||  OF | OF | OF | OF | OF | OF | OF | OF |
+====+====+====+====+====+====+====+=====++=====+====+====+====+====+====+====+====+
|&lt;------------ header size (?) ---------&gt;||&lt;----- offset third section start -----&gt;|

+====+====+====+====+====+====+====+=====+
| OE | OE | OE | OE | OE | OE | OE | OE  |
+====+====+====+====+====+====+====+=====+
|&lt;---- offset third section end --------&gt;|
</code></pre><h2 id=filename-section>Filename Section</h2><p>Not much to say there.</p><p>Here&rsquo;s what it looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx| less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00002700  fb 14 00 00 00 00 00 00  74 d1 1b 8d f4 ff 7a ce  |........t.....z.|
00002710  a4 eb 1b 3e 50 21 d8 74  4b 44 53 74 6f 72 61 67  |...&gt;P!.tKDStorag|
00002720  65 2e 62 69 6e 00 77 61  76 65 73 5f 68 65 69 67  |e.bin.waves_heig|
00002730  68 74 73 31 2e 64 64 73  00 61 6e 69 6d 61 74 65  |hts1.dds.animate|
[...]
000028c0  74 73 2e 62 69 6e 00 6d  69 73 63 53 65 74 74 69  |ts.bin.miscSetti|
000028d0  6e 67 73 2e 78 6d 6c 00  64 61 6d 61 67 65 5f 64  |ngs.xml.damage_d|
000028e0  65 63 5f 32 5f 64 2e 64  64 32 00 64 61 6d 61 67  |ec_2_d.dd2.damag|
000028f0  65 5f 64 65 63 5f 31 5f  65 2e 64 64 73 00 63 72  |e_dec_1_e.dds.cr|
[...]
00003be0  61 72 69 61 74 69 6f 6e  5f 64 75 6d 6d 79 2e 64  |ariation_dummy.d|
00003bf0  64 73 00 77 61 76 65 73  5f 68 65 69 67 68 74 73  |ds.waves_heights|
00003c00  30 2e 64 64 73 00 8f 0c  9a ba 4f 40 b6 93 70 11  |0.dds.....O@..p.|
00003c10  03 07 0d 33 ed 77 00 00  00 00 00 00 00 00 05 00  |...3.w..........|
00003c20  00 00 01 00 00 00 f5 21  00 00 bf 00 45 5c 6c 36  |.......!....E\l6|
</code></pre><p>So it&rsquo;s a bunch of <code>\0</code> separated strings. The only thing interesting to note is that it&rsquo;s not a fixed size section.</p><h2 id=pkg-pointer-section>PKG Pointer Section</h2><p>Here what it looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -C system_data.idx| less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00003bf0  64 73 00 77 61 76 65 73  5f 68 65 69 67 68 74 73  |ds.waves_heights|
00003c00  30 2e 64 64 73 00 8f 0c  9a ba 4f 40 b6 93 70 11  |0.dds.....O@..p.|
00003c10  03 07 0d 33 ed 77 00 00  00 00 00 00 00 00 05 00  |...3.w..........|
00003c20  00 00 01 00 00 00 f5 21  00 00 bf 00 45 5c 6c 36  |.......!....E\l6|
00003c30  00 00 00 00 00 00 8f ec  87 4a 28 d0 f7 c7 70 11  |.........J(...p.|
00003c40  03 07 0d 33 ed 77 1e 9b  ef 05 00 00 00 00 05 00  |...3.w..........|
00003c50  00 00 01 00 00 00 15 15  01 00 03 77 63 97 3e ab  |...........wc.&gt;.|
00003c60  02 00 00 00 00 00 ad 70  a2 e7 ac 2c 4f 6b 70 11  |.......p...,Okp.|
00003c70  03 07 0d 33 ed 77 05 22  00 00 00 00 00 00 05 00  |...3.w.&#34;........|
00003c80  00 00 01 00 00 00 cb 01  00 00 6d b9 de c1 ad 0c  |..........m.....|
00003c90  00 00 00 00 00 00 8e c7  6a 58 7c 86 62 33 70 11  |........jX|.b3p.|
00003ca0  03 07 0d 33 ed 77 e0 23  00 00 00 00 00 00 05 00  |...3.w.#........|
00003cb0  00 00 01 00 00 00 65 00  00 00 f1 d2 87 5a d2 00  |......e......Z..|
00003cc0  00 00 00 00 00 00 8e 43  3d e9 cf 49 52 a4 70 11  |.......C=..IR.p.|
00003cd0  03 07 0d 33 ed 77 4d 1f  6a 05 00 00 00 00 05 00  |...3.wM.j.......|
00003ce0  00 00 01 00 00 00 bb 19  00 00 f7 53 4a b1 38 ab  |...........SJ.8.|
00003cf0  00 00 00 00 00 00 0e 3c  9a 6d 22 de 7b da 70 11  |.......&lt;.m&#34;.{.p.|
00003d00  03 07 0d 33 ed 77 55 24  00 00 00 00 00 00 05 00  |...3.wU$........|
00003d10  00 00 01 00 00 00 72 0d  00 00 83 0a 72 88 a3 5c  |......r.....r..\|
00003d20  00 00 00 00 00 00 98 45  00 7a 16 6e 84 21 70 11  |.......E.z.n.!p.|
00003d30  03 07 0d 33 ed 77 73 ce  cb 06 00 00 00 00 05 00  |...3.ws.........|
00003d40  00 00 01 00 00 00 f9 b6  b7 00 ff 7e f7 7b 5b 30  |...........~.{[0|
00003d50  b8 00 00 00 00 00 98 51  4a 00 2c 12 71 ad 70 11  |.......QJ.,.q.p.|
00003d60  03 07 0d 33 ed 77 7e 63  75 05 00 00 00 00 05 00  |...3.w~cu.......|
[...]
00007100  00 00 01 00 00 00 6f 09  00 00 fc 56 94 f8 9a 37  |......o....V...7|
00007110  00 00 00 00 00 00 21 67  ac 70 22 ec ca b8 70 11  |......!g.p&#34;...p.|
00007120  03 07 0d 33 ed 77 28 f9  15 0a 00 00 00 00 05 00  |...3.w(.........|
00007130  00 00 01 00 00 00 0b 2d  00 00 03 bd b0 50 67 e9  |.......-.....Pg.|
00007140  00 00 00 00 00 00 15 00  00 00 00 00 00 00 18 00  |................|
00007150  00 00 00 00 00 00 70 11  03 07 0d 33 ed 77 73 79  |......p....3.wsy|
00007160  73 74 65 6d 5f 64 61 74  61 5f 30 30 30 31 2e 70  |stem_data_0001.p|
00007170  6b 67 00                                          |kg.|
00007173
(END)
</code></pre><p>This section contains 384-bit records (48 bytes each) linking files to their data in <code>.pkg</code> files through IDs and offsets.</p><p>Each record contains metadata IDs, PKG file offsets, data sizes, and compression types.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># let&#39;s skip the first 6 bytes to align hexdump output</span>
</span></span><span style=display:flex><span>kakwa@linux 6775398/idx » hexdump -s <span style=color:#ae81ff>6</span> -C system_data.idx| less
</span></span></code></pre></div><pre tabindex=0><code>[...]
00003be6  6f 6e 5f 64 75 6d 6d 79  2e 64 64 73 00 77 61 76  |on_dummy.dds.wav|
00003bf6  65 73 5f 68 65 69 67 68  74 73 30 2e 64 64 73 00  |es_heights0.dds.|
00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
00003c16  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
00003c36  8f ec 87 4a 28 d0 f7 c7  70 11 03 07 0d 33 ed 77  |...J(...p....3.w|
00003c46  1e 9b ef 05 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c56  15 15 01 00 03 77 63 97  3e ab 02 00 00 00 00 00  |.....wc.&gt;.......|
00003c66  ad 70 a2 e7 ac 2c 4f 6b  70 11 03 07 0d 33 ed 77  |.p...,Okp....3.w|
[...]
</code></pre><p>Much nicer!</p><p>With that, we immediately notice a cycle, with the <code>70 11 03 07 0d 33 ed 77</code> value.</p><p>There are 6 × 64 = 384 bits between each <code>70 11 03 07 0d 33 ed 77</code> value.</p><p>Let&rsquo;s try to confirm that with the IDs.</p><p>We are spotting the <code>bf 00 45 5c 6c 36</code> seen previously in the <code>.pkg</code> file. 384 bits later, we see <code>03 77 63 97 3e ab 02</code>.</p><p>With a bit of digging (it&rsquo;s right in the middle of the <code>.pkg</code> file, and this ID is not neatly in a 64-bit aligned chunk because of the variable size of the DEFLATE blocks), we indeed find it.</p><p>We have indeed a 384-bit cycle, which neatly fits in 3 lines of hexdump!</p><p>So each of these is one record:</p><pre tabindex=0><code>00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
00003c16  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
</code></pre><pre tabindex=0><code>00003c36  8f ec 87 4a 28 d0 f7 c7  70 11 03 07 0d 33 ed 77  |...J(...p....3.w|
00003c46  1e 9b ef 05 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c56  15 15 01 00 03 77 63 97  3e ab 02 00 00 00 00 00  |.....wc.&gt;.......|
</code></pre><pre tabindex=0><code>00003c66  ad 70 a2 e7 ac 2c 4f 6b  70 11 03 07 0d 33 ed 77  |.p...,Okp....3.w|
00003c76  05 22 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |.&#34;..............|
00003c86  cb 01 00 00 6d b9 de c1  ad 0c 00 00 00 00 00 00  |....m...........|
</code></pre><pre tabindex=0><code>00003c96  8e c7 6a 58 7c 86 62 33  70 11 03 07 0d 33 ed 77  |..jX|.b3p....3.w|
00003ca6  e0 23 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |.#..............|
00003cb6  65 00 00 00 f1 d2 87 5a  d2 00 00 00 00 00 00 00  |e......Z........|
</code></pre><pre tabindex=0><code>00003cc6  8e 43 3d e9 cf 49 52 a4  70 11 03 07 0d 33 ed 77  |.C=..IR.p....3.w|
00003cd6  4d 1f 6a 05 00 00 00 00  05 00 00 00 01 00 00 00  |M.j.............|
00003ce6  bb 19 00 00 f7 53 4a b1  38 ab 00 00 00 00 00 00  |.....SJ.8.......|
</code></pre><p>All these records are from the same file,</p><p>let&rsquo;s grab a few from other files:</p><p>File 2:</p><pre tabindex=0><code>0000f6fd  58 fe 65 b4 59 b6 b0 77  a4 8c 78 6a 58 aa 65 84  |X.e.Y..w..xjX.e.|
0000f70d  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
0000f71d  bc 99 05 00 f4 3a 67 8b  80 00 08 00 00 00 00 00  |.....:g.........|
</code></pre><pre tabindex=0><code>0000f72d  a0 e5 c7 22 cc 49 d3 31  a4 8c 78 6a 58 aa 65 84  |...&#34;.I.1..xjX.e.|
0000f73d  3e 9e 7e 05 00 00 00 00  05 00 00 00 01 00 00 00  |&gt;.~.............|
0000f74d  79 c6 03 00 dc b8 5f 80  80 00 08 00 00 00 00 00  |y....._.........|
</code></pre><p>File 3:</p><pre tabindex=0><code>00002d0c  ed cf 33 f8 a5 94 53 56  0d a7 9c b9 bf 60 f5 3e  |..3...SV.....`.&gt;|
00002d1c  40 a8 08 07 00 00 00 00  00 00 00 00 00 00 00 00  |@...............|
00002d2c  38 ab 00 00 5d cf 4e b6  38 ab 00 00 00 00 00 00  |8...].N.8.......|
</code></pre><pre tabindex=0><code>00002d3c  ed ea da 52 4e 8f 70 ed  0d a7 9c b9 bf 60 f5 3e  |...RN.p......`.&gt;|
00002d4c  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00002d5c  98 00 00 00 a4 63 f2 9b  98 00 00 00 00 00 00 00  |.....c..........|
</code></pre><p>Lets study:</p><pre tabindex=0><code>00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
00003c16  00 00 00 00 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
</code></pre><p>For the first 128 bits we get:</p><pre tabindex=0><code>00003c06  8f 0c 9a ba 4f 40 b6 93  70 11 03 07 0d 33 ed 77  |....O@..p....3.w|
</code></pre><p>From the fact the last 64 bits are constant, we can deduce we have probably two 64 bits integers in the first 128 bits</p><p>Once again, these are using all the available bits and seem rather random. It&rsquo;s difficult to link these to their role, so&mldr; lets simply ignore these for now.</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
| UO | UO | UO | UO | UO | UO | UO | UO || UT | UT | UT | UT | UT | UT | UT | UT |
+====+====+====+====+====+====+====+====++====+====+====+====+====+====+====+====+
|&lt;------------ unknown 1 --------------&gt;||&lt;------------- unknow 2 --------------&gt;|
|               64 bits                 ||               64 bits                 |
</code></pre><p>Next 64 bits, we have a low value 64 bits integer, so most likely an offset. It is also suspiciously at <code>0x0</code> for the first record which is also the first data chunk in the <code>.pkg</code> file.</p><p>So, it&rsquo;s most likely the start of a data chunk in a <code>.pkg</code> file. Looking at other records confirms that.</p><p>Next, we have two extremely low value 32 bits (0x5 and 0x1). So once again, most likely some kind of enum, lets call them <code>type1</code> and <code>type2</code>.</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
| OF | OF | OF | OF | OF | OF | OF | OF || T1 | T1 | T1 | T1 || T2 | T2 | T2 | T2 |
+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;----------start offset pkg ----------&gt;||&lt;---- type 1 -----&gt;||&lt;----- type 2 ----&gt;|
|               64 bits                 ||     32 bits       ||      32 bits      |
</code></pre><p>For the Last 128 bits, we get the following:</p><pre tabindex=0><code>00003c26  f5 21 00 00 bf 00 45 5c  6c 36 00 00 00 00 00 00  |.!....E\l6......|
</code></pre><p>So, here, we see our <code>.pkg</code> ID (<code>bf 00 45 5c 6c 36</code>) right in the middle. Given its size, this ID is probably stored on 64 bits.</p><p>After that, last 32 bits, we get a bunch of <code>00</code>, maybe a reserved field, but more likely some kind of padding.</p><p>Before that, we get a low value 32 bits integer. When comparing with the <code>.pkg</code> file, <code>f5 21 00 00</code> is the offset where the first data chunk ends.</p><p>So it&rsquo;s the end offset. But 32 bits seems rather small to store such offset (specially given the start offset is 64 bits. Also, for other data chunks, this doesn&rsquo;t line-up.</p><p>However, it could very much be a relative offset (to the start of the data chunk).</p><p>Lets validate that with the second record:</p><pre tabindex=0><code>00003c36  8f ec 87 4a 28 d0 f7 c7  70 11 03 07 0d 33 ed 77  |...J(...p....3.w|
00003c46  1e 9b ef 05 00 00 00 00  05 00 00 00 01 00 00 00  |................|
00003c56  15 15 01 00 03 77 63 97  3e ab 02 00 00 00 00 00  |.....wc.&gt;.......|
</code></pre><p>More hexdump! (searching the data chunk using the <code>03 77 63 97 3e ab 02</code> ID and the start offset <code>1e 9b ef 05 00 00 00 00</code>, or <code>0x05ef9b1e</code> once we take endianess into account):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kakwa@linux World of Warships/res_packages » hexdump -C system_data_0001.pkg | less
</span></span></code></pre></div><pre tabindex=0><code>[...]
05ef9b10  00 00 17 4b 28 42 80 40  00 00 00 00 00 00 8c 7d  |...K(B.@.......}|
05ef9b20  3b 50 5d d9 b6 dd 7d b6  3e 76 15 b2 5f 20 89 04  |;P]...}.&gt;v.._ ..|
05ef9b30  55 bd 00 44 82 aa ec 7a  9c bd f7 79 45 57 39 40  |U..D...z...yEW9@|
05ef9b40  90 d0 4e 8c c0 01 9d 21  48 e8 0c 41 a2 ce 10 24  |..N....!H..A...$|
[...]
05f0b010  d1 d7 52 b0 de cc fa 9c  2b 8d b5 57 a4 02 ff 1a  |..R.....+..W....|
05f0b020  43 5d 2d 43 3f cc d1 0b  f8 88 92 a8 9f 5a 70 64  |C]-C?........Zpd|
05f0b030  46 fb 7f 00 00 00 00 03  77 63 97 3e ab 02 00 00  |F.......wc.&gt;....|
05f0b040  00 00 00 94 b7 67 90 db  68 9e e6 d9 1f 36 62 6f  |.....g..h....6bo|
05f0b050  6f 22 76 f6 62 e3 62 77  67 7a 7a ba ab bb 8c aa  |o&#34;v.b.bwgzz.....|
05f0b060  4a 52 95 5c ca a5 cf 64  d2 24 bd 27 41 d0 00 04  |JR.\...d.$.&#39;A...|
[...]
</code></pre><p>We indeed find the start of our data chunk at <code>05ef9b1e</code> (<code>8c</code> after a bunch of <code>00</code> on the first line).</p><p>And looking for the <code>00 00 00 00 ID ID [...]</code> pattern in between the data chunks, we can determine the end of this chunk to be at <code>0x05f0b032</code>.</p><p>Doing <code>0x05f0b032 - 0x05ef9b1e</code>, we get <code>0x11514</code>, that&rsquo;s almost our <code>15 15 01 00</code> once we swap endianess, and add <code>1</code>.</p><pre tabindex=0><code>+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
| OE | OE | OE | OE || ID | ID | ID | ID | ID | ID | ID | ID || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
|&lt;-- offset end ---&gt;||&lt;------------- ID &#39;.pkg&#39; -------------&gt;||&lt;---- padding ----&gt;|
|     32 bits       ||               64 bits                 ||      32 bits      |
</code></pre><p>So to recap, we have:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
| UO | UO | UO | UO | UO | UO | UO | UO ||  UT | UT | UT | UT | UT | UT | UT | UT |
+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
|&lt;------------ unknown 1 --------------&gt;||&lt;-------------- unknown 2 -------------&gt;|
|               64 bits                 ||                64 bits                 |
+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
| OF | OF | OF | OF | OF | OF | OF | OF || T1 | T1 | T1 | T1 || T2 | T2 | T2 | T2 |
+====+====+====+====+====+====+====+====++====+====+====+====++====+====+====+====+
|&lt;--------- start offset pkg ----------&gt;||&lt;---- type 1 -----&gt;||&lt;----- type 2 ----&gt;|
|               64 bits                 ||     32 bits       ||      32 bits      |
+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
| OE | OE | OE | OE || ID | ID | ID | ID | ID | ID | ID | ID || 00 | 00 | 00 | 00 |
+====+====+====+====++====+====+====+====+====+====+====+====++====+====+====+====+
|&lt;-- offset end ---&gt;||&lt;------------- ID &#39;.pkg&#39; -------------&gt;||&lt;---- padding ----&gt;|
|     32 bits       ||               64 bits                 ||      32 bits      |
</code></pre><h2 id=the-last-bits>The Last Bits</h2><p>So, okay, we have the core of the 3 parts of the file.</p><p>But we can see the last few bits don&rsquo;t follow this pattern (especially with the <code>.pkg</code> file name), which means we have a footer:</p><pre tabindex=0><code># Last block
00007116  21 67 ac 70 22 ec ca b8  70 11 03 07 0d 33 ed 77  |!g.p&#34;...p....3.w|
00007126  28 f9 15 0a 00 00 00 00  05 00 00 00 01 00 00 00  |(...............|
00007136  0b 2d 00 00 03 bd b0 50  67 e9 00 00 00 00 00 00  |.-.....Pg.......|
# Footer
00007146  15 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|
00007156  70 11 03 07 0d 33 ed 77  73 79 73 74 65 6d 5f 64  |p....3.wsystem_d|
00007166  61 74 61 5f 30 30 30 31  2e 70 6b 67 00           |ata_0001.pkg.|
</code></pre><p>If we look at the content, we have 3 × 64 bits before the name starts (<code>73 79 73 74 65 6d 5f 64</code> for <code>system_d</code>)</p><p>Looking at it more closely, given all the <code>00</code>, it seems we have three 64-bit integers there.</p><ul><li><code>15 00 00 00 00 00 00 00</code></li><li><code>18 00 00 00 00 00 00 00</code></li><li><code>70 11 03 07 0d 33 ed 77</code></li></ul><p><code>70 11 03 07 0d 33 ed 77</code> is the &ldquo;unknown 2&rdquo; we saw previously, so still no luck, but let&rsquo;s name it the same way.</p><p><code>18 00 00 00 00 00 00 00</code> seems to have the same value across all files, so probably not that important.</p><p>The only one that varies across files is the <code>15 00 00 00 00 00 00 00</code>, but always in the same kind of values around 0x15. In decimal it&rsquo;s 21.</p><p>Strangely, <code>system_data_0001.pkg</code> is 20 chars long, 21 if we include the <code>\0</code> at the end.</p><p>So we can deduce it&rsquo;s actually the <code>.pkg</code> file name string size.</p><p>So we have:</p><pre tabindex=0><code>+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
| UO | UO | UO | UO | UO | UO | UO | UO ||  U3 | U3 | U3 | U3 | U3 | U3 | U3 | U3 |
+====+====+====+====+====+====+====+====++=====+====+====+====+====+====+====+====+
|&lt;--------- size pkg file name --------&gt;||&lt;-------------- unknown 3 -------------&gt;|
|               64 bits                 ||                64 bits                 |
+=====+====+====+====+====+====+====+====+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
|  UT | UT | UT | UT | UT | UT | UT | UT |             file name string
+=====+====+====+====+====+====+====+====+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~...
|&lt;-------------- unknown 2 -------------&gt;|
|                64 bits                 |
</code></pre><h1 id=recap-part-3>Recap (Part 3)</h1><ul><li>Mapped overall <code>.idx</code> layout into 4 parts:<ul><li>Header: magic <code>ISFP</code>, counts (entries and files), header-size-like field, offsets to start/end of the third section, and a per-file id/crc-like value.</li><li>Names: <code>\0</code>-separated file and directory names.</li><li>Records section (per-record 384 bits): two 64-bit unknowns (likely ids, one enabling parent/child hierarchy), 64-bit start offset in <code>.pkg</code>, 2×32-bit types, 32-bit relative end size, 64-bit <code>.pkg</code> chunk id, and padding.</li><li>Footer: <code>.pkg</code> filename length, an unknown 64-bit value, a repeated 64-bit constant, then the <code>.pkg</code> filename string.</li></ul></li><li>Established the link between names and <code>.pkg</code> chunks via IDs and offsets, enough to reconstruct directories and locate data.</li></ul><p>In <a href=/posts/wows_depack_part4/>the next part</a> of this series we will start the actual implementation.</p><hr><div class=footer><a class=previous-post href="https://technically.kakwalab.ovh/posts/wows_depack_part2/?ref=footer"><span style=font-weight:700>« Previous</span><br>Reversing WoWs Resource Format - Part 2: Looking...</a><div class=next-post><a href="https://technically.kakwalab.ovh/posts/wows_depack_part4/?ref=footer"><span style=font-weight:700>Next »</span><br>Reversing WoWs Resource Format - Part 4: Reading...</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><nav id=TableOfContents><ol><li><a href=#index-file-reverse-engineering>Index File Reverse Engineering</a><ol><li><a href=#metadata-chunk-format>Metadata Chunk Format</a></li><li><a href=#header-section-analysis>Header Section Analysis</a></li><li><a href=#filename-section>Filename Section</a></li><li><a href=#pkg-pointer-section>PKG Pointer Section</a></li><li><a href=#the-last-bits>The Last Bits</a></li></ol></li><li><a href=#recap-part-3>Recap (Part 3)</a></li></ol></nav></div></div></div></body></html>